<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>US Tariff Intelligence Desk</title>
  <meta name="description" content="Country-level tariff intelligence for U.S. tariffs, countermeasures, commodity exposure, and legal status." />
  <link rel="preconnect" href="https://assets.bwbx.io" />
  <link href="https://assets.bwbx.io/font-service/css/AvenirNextPForBBG:400,500,600,700/styled-font-face.css" rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    /* ═══════════════════════════════════════════════════
       US TARIFF INTELLIGENCE DESK — Design System v2
       Full Dark Terminal  ·  Feb 2026
    ═══════════════════════════════════════════════════ */

    :root {
      /* ── Dark Surface Stack ── */
      --s0: #06080f;
      --s1: #0b0d17;
      --s2: #0f1220;
      --s3: #141728;
      --s4: #1a1e30;
      --s5: #212538;

      /* ── Border Hierarchy ── */
      --b0: rgba(255,255,255,0.045);
      --b1: rgba(255,255,255,0.085);
      --b2: rgba(255,255,255,0.14);
      --b3: rgba(255,255,255,0.22);

      /* ── Text Hierarchy ── */
      --t0: #e8eaf3;
      --t1: rgba(232,234,243,0.75);
      --t2: rgba(232,234,243,0.48);
      --t3: rgba(232,234,243,0.28);

      /* ── Accent & Semantic ── */
      --accent:        #ff9d00;
      --accent-dim:    rgba(255,157,0,0.18);
      --accent-border: rgba(255,157,0,0.38);
      --teal:          #00d4aa;
      --teal-dim:      rgba(0,212,170,0.13);
      --teal-border:   rgba(0,212,170,0.32);
      --amber:         #ffb300;
      --amber-dim:     rgba(255,179,0,0.12);
      --amber-border:  rgba(255,179,0,0.32);
      --red:           #ff4560;
      --red-dim:       rgba(255,69,96,0.12);
      --red-border:    rgba(255,69,96,0.32);
      --blue:          #5b9bff;
      --blue-dim:      rgba(91,155,255,0.12);
      --blue-border:   rgba(91,155,255,0.30);

      /* ── Legacy BBG Aliases (keep for compat) ── */
      --bbg-black:      #000000;
      --bbg-gray-95:    #0b0c10;
      --bbg-gray-90:    #141419;
      --bbg-gray-80:    #2d2d32;
      --bbg-gray-70:    #46464b;
      --bbg-gray-50:    #616166;
      --bbg-gray-40:    #95959a;
      --bbg-gray-20:    #c8c8cd;
      --bbg-white:      var(--t0);
      --bbg-accent:     var(--accent);
      --bbg-accent-soft:#ffcf87;
      --bbg-link:       var(--blue);
      --bbg-link-hover: #7aaeff;
      --bbg-success:    var(--teal);
      --bbg-danger:     var(--red);
      --bbg-warn:       var(--amber);
      --text:           var(--t0);
      --muted:          var(--t2);
      --surface:        var(--s2);
      --surface-soft:   var(--s3);
      --surface-border: var(--b1);
      --surface-border-2:var(--b0);
      --shadow: 0 28px 64px rgba(0,0,0,0.65), 0 4px 16px rgba(0,0,0,0.4);
    }

    /* ── Reset ── */
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; min-height: 100%; }

    /* ── Custom Scrollbars ── */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: var(--s1); }
    ::-webkit-scrollbar-thumb { background: rgba(255,157,0,0.35); border-radius: 999px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,157,0,0.65); }
    * { scrollbar-width: thin; scrollbar-color: rgba(255,157,0,0.35) var(--s1); }

    /* ── Selection ── */
    ::selection { background: rgba(255,157,0,0.32); color: #fff; }

    /* ── Focus Rings ── */
    :focus-visible {
      outline: 2px solid rgba(255,157,0,0.55);
      outline-offset: 2px;
      border-radius: 4px;
    }

    /* ── Body ── */
    body {
      font-family: "Avenir Next P for BBG", AvenirNextPForBBG, Avenir, "Avenir Next", Helvetica, Arial, sans-serif;
      background: var(--s0);
      color: var(--t0);
      line-height: 1.5;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 70% 45% at 12% 0%, rgba(255,157,0,0.07) 0%, transparent 55%),
        radial-gradient(ellipse 55% 40% at 92% 0%, rgba(0,40,120,0.12) 0%, transparent 55%),
        radial-gradient(ellipse 50% 55% at 50% 105%, rgba(0,212,170,0.04) 0%, transparent 60%);
      pointer-events: none;
      z-index: -2;
    }

    body::after {
      content: "";
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
      background-size: 200px 200px;
      pointer-events: none;
      z-index: -1;
      opacity: 0.6;
    }

    /* ── Shell ── */
    .shell {
      max-width: 1340px;
      margin: 0 auto;
      padding: 0 16px 60px;
    }

    /* ═══════════════════════
       HEADER
    ═══════════════════════ */
    .header {
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.08);
      border-top: none;
      border-radius: 0 0 18px 18px;
      background: linear-gradient(128deg, #05060d 0%, #0d1020 52%, #101525 100%);
      box-shadow: 0 24px 64px rgba(0,0,0,0.7), 0 0 0 1px rgba(255,157,0,0.06);
      padding: 16px 24px 0;
    }

    .header::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        linear-gradient(98deg, rgba(4,5,10,0.92) 0%, rgba(4,5,10,0.6) 45%, rgba(4,5,10,0.52) 100%),
        url("https://assets.bbhub.io/image/v1/convert?type=auto&url=https%3A%2F%2Fassets.bbhub.io%2Fprofessional%2Fsites%2F41%2FTerminal-Header-062727-4k_v11_00000.png") center / cover no-repeat;
      pointer-events: none;
    }

    .header::after {
      content: "";
      position: absolute;
      inset: 0;
      background:
        linear-gradient(180deg, rgba(255,255,255,0.04), transparent 20%, transparent 78%, rgba(255,255,255,0.02)),
        radial-gradient(ellipse 80% 60% at 50% 0%, rgba(255,157,0,0.06) 0%, transparent 60%);
      pointer-events: none;
      mix-blend-mode: soft-light;
    }

    .header > * { position: relative; z-index: 1; }

    /* ── Terminal Strip ── */
    .terminal-strip {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding-bottom: 10px;
    }

    .terminal-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .terminal-pill {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      font-size: 0.73rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.82);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 999px;
      padding: 5px 11px;
      background: rgba(255,255,255,0.06);
      white-space: nowrap;
      -webkit-backdrop-filter: blur(6px);
      backdrop-filter: blur(6px);
    }

    .terminal-led {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(255,157,0,0.8), 0 0 20px rgba(255,157,0,0.4);
      flex-shrink: 0;
      animation: ledPulse 2.4s ease-in-out infinite;
    }

    @keyframes ledPulse {
      0%, 100% { box-shadow: 0 0 10px rgba(255,157,0,0.8), 0 0 20px rgba(255,157,0,0.4); }
      50%       { box-shadow: 0 0 6px rgba(255,157,0,0.5), 0 0 12px rgba(255,157,0,0.2); }
    }

    /* ── Ticker ── */
    .ticker-window {
      max-width: 640px;
      overflow: hidden;
      mask-image: linear-gradient(90deg, transparent 0%, #000 6%, #000 94%, transparent 100%);
    }

    .ticker-track {
      display: inline-flex;
      align-items: center;
      gap: 28px;
      white-space: nowrap;
      animation: tickerSlide 60s linear infinite;
      font-size: 0.78rem;
      color: rgba(255,255,255,0.78);
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
      letter-spacing: 0.02em;
    }

    .ticker-window:hover .ticker-track { animation-play-state: paused; }

    .ticker-item {
      display: inline-flex;
      align-items: center;
      gap: 9px;
    }

    .ticker-item::before {
      content: "";
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: var(--accent);
      opacity: 0.85;
      flex-shrink: 0;
    }

    /* ── Title Row ── */
    .title-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
      gap: 14px;
      margin-top: 20px;
      margin-bottom: 14px;
    }

    .hero-kicker {
      margin: 0 0 8px;
      font-size: 0.88rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-weight: 700;
      color: var(--accent);
    }

    h1 {
      margin: 0;
      color: #fff;
      font-size: clamp(2rem, 3.2vw, 3.1rem);
      line-height: 1.1;
      font-weight: 700;
      max-width: 900px;
      overflow-wrap: break-word;
      text-wrap: balance;
      letter-spacing: -0.02em;
    }

    /* ── Chips ── */
    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.07);
      color: rgba(255,255,255,0.82);
      padding: 5px 11px;
      font-size: 0.78rem;
      line-height: 1;
      white-space: nowrap;
      -webkit-backdrop-filter: blur(6px);
      backdrop-filter: blur(6px);
    }

    .chip b { color: #fff; font-weight: 600; }

    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(255,157,0,0.7);
      flex-shrink: 0;
    }

    /* ── Legal Alert ── */
    .legal-alert {
      margin-top: 12px;
      border: 1px solid rgba(255,157,0,0.32);
      background: linear-gradient(180deg, rgba(255,157,0,0.12), rgba(255,157,0,0.05));
      border-radius: 10px;
      padding: 13px 16px;
      max-width: 1100px;
    }

    .legal-alert strong { color: #ffcc80; font-weight: 600; }
    .legal-alert p { margin: 0; color: #ffe0b2; font-size: 0.94rem; line-height: 1.5; }

    /* ── Countdown Bar ── */
    .countdown-bar {
      margin-top: 11px;
      border: 1px solid rgba(255,157,0,0.35);
      border-radius: 8px;
      background: rgba(255,157,0,0.07);
      padding: 9px 14px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .countdown-bar .label {
      font-size: 0.72rem;
      color: rgba(255,255,255,0.6);
      text-transform: uppercase;
      letter-spacing: 0.07em;
    }

    .countdown-bar .timer {
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
      font-size: 1rem;
      color: var(--accent);
      font-weight: 700;
      letter-spacing: 0.03em;
      text-shadow: 0 0 16px rgba(255,157,0,0.5);
    }

    /* ── KPI Grid ── */
    .kpi-grid {
      margin-top: 16px;
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
    }

    .kpi {
      border: 1px solid var(--b1);
      border-top: 2px solid var(--accent);
      border-radius: 10px;
      background: rgba(6,8,14,0.7);
      -webkit-backdrop-filter: blur(8px);
      backdrop-filter: blur(8px);
      padding: 13px 14px;
      min-height: 90px;
      position: relative;
      overflow: hidden;
      transition: border-top-color 200ms;
    }

    .kpi::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse 80% 50% at 50% 0%, rgba(255,157,0,0.1) 0%, transparent 70%);
      pointer-events: none;
    }

    .kpi .label {
      color: var(--t2);
      font-size: 0.69rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 7px;
      line-height: 1.3;
    }

    .kpi .value {
      color: #fff;
      font-size: 1.65rem;
      font-weight: 700;
      line-height: 1.1;
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
      letter-spacing: -0.02em;
    }

    .kpi .sub {
      font-size: 0.68rem;
      color: var(--teal);
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
      margin-top: 4px;
      letter-spacing: 0.02em;
    }

    /* ═══════════════════════
       FUNCTION KEY NAV
    ═══════════════════════ */
    .fnkeys {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      margin-top: 16px;
      border-top: 1px solid rgba(255,157,0,0.2);
      border-radius: 0 0 14px 14px;
      overflow: hidden;
    }

    .fnkey {
      appearance: none;
      border: 0;
      border-right: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.25);
      padding: 11px 6px 10px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      position: relative;
      transition: background 130ms ease;
      font-family: inherit;
      text-align: center;
    }

    .fnkey:last-child { border-right: 0; }

    .fn-num {
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
      font-size: 0.58rem;
      font-weight: 500;
      letter-spacing: 0.06em;
      color: rgba(255,157,0,0.48);
      line-height: 1;
    }

    .fn-label {
      font-size: 0.68rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.55);
      line-height: 1.15;
      white-space: nowrap;
    }

    .fnkey:hover { background: rgba(255,157,0,0.1); }
    .fnkey:hover .fn-label { color: rgba(255,255,255,0.9); }
    .fnkey:hover .fn-num   { color: rgba(255,157,0,0.85); }

    .fnkey.active {
      background: rgba(255,157,0,0.14);
      border-top: 2px solid var(--accent);
    }

    .fnkey.active::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at 50% 0%, rgba(255,157,0,0.2) 0%, transparent 70%);
      pointer-events: none;
    }

    .fnkey.active .fn-num   { color: var(--accent); }
    .fnkey.active .fn-label { color: #fff; font-weight: 700; }

    /* ═══════════════════════
       VIEWS / CONTENT
    ═══════════════════════ */
    .view {
      display: none;
      margin-top: 14px;
      border: 1px solid var(--b1);
      border-radius: 14px;
      background: var(--s1);
      padding: 24px;
      box-shadow: var(--shadow);
    }

    .view.active {
      display: block;
      animation: riseIn 240ms ease both;
    }

    .section-title {
      margin: 0 0 10px;
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      color: var(--t0);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title::before {
      content: "";
      display: inline-block;
      width: 3px;
      height: 1.1em;
      background: var(--accent);
      border-radius: 2px;
      flex-shrink: 0;
    }

    .small-note {
      margin: 0 0 18px;
      color: var(--t2);
      font-size: 0.91rem;
      line-height: 1.55;
      max-width: 860px;
    }

    /* ═══════════════════════
       CARDS & PANELS
    ═══════════════════════ */
    .cards-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px;
    }

    .panel {
      border: 1px solid var(--b1);
      border-left: 3px solid var(--b2);
      border-radius: 12px;
      background: linear-gradient(160deg, var(--s2) 0%, var(--s3) 100%);
      padding: 16px;
      transition: transform 180ms ease, box-shadow 180ms ease, border-left-color 180ms ease;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse 100% 60% at 50% 0%, rgba(255,255,255,0.025) 0%, transparent 100%);
      pointer-events: none;
      border-radius: inherit;
    }

    .panel:hover {
      transform: translateY(-3px);
      border-left-color: var(--accent);
      box-shadow: 0 16px 40px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,157,0,0.1);
    }

    /* Panel accent rail variants */
    .panel-teal   { border-left-color: var(--teal); }
    .panel-teal:hover { border-left-color: var(--teal); box-shadow: 0 16px 40px rgba(0,0,0,0.5), 0 0 0 1px rgba(0,212,170,0.12); }

    .panel-amber  { border-left-color: var(--amber); }
    .panel-amber:hover { border-left-color: var(--amber); box-shadow: 0 16px 40px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,179,0,0.12); }

    .panel-orange { border-left-color: var(--accent); }
    .panel-orange:hover { box-shadow: 0 16px 40px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,157,0,0.12); }

    .panel-red    { border-left-color: var(--red); }
    .panel-red:hover { border-left-color: var(--red); box-shadow: 0 16px 40px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,69,96,0.12); }

    .panel h3 {
      margin: 0 0 12px;
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--t0);
      letter-spacing: 0.01em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel h3::before {
      content: "";
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 8px rgba(255,157,0,0.6);
      flex-shrink: 0;
    }

    .panel-teal h3::before   { background: var(--teal);  box-shadow: 0 0 8px rgba(0,212,170,0.6); }
    .panel-amber h3::before  { background: var(--amber); box-shadow: 0 0 8px rgba(255,179,0,0.6); }
    .panel-red h3::before    { background: var(--red);   box-shadow: 0 0 8px rgba(255,69,96,0.6); }
    .panel-orange h3::before { background: var(--accent); }

    .panel p,
    .panel li {
      margin: 0;
      color: var(--t1);
      font-size: 0.88rem;
      line-height: 1.58;
    }

    .panel ul {
      margin: 0;
      padding-left: 0;
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 9px;
    }

    .panel li {
      padding: 9px 10px;
      border-radius: 7px;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--b0);
      position: relative;
    }

    .panel li strong {
      color: var(--t0);
      font-weight: 600;
    }

    /* ═══════════════════════
       STATUS PILLS (Dark + Glow)
    ═══════════════════════ */
    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      border-radius: 6px;
      padding: 3px 9px;
      font-size: 0.67rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      border: 1px solid transparent;
      text-transform: uppercase;
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
      white-space: nowrap;
    }

    .status-pill::before {
      content: "";
      width: 5px;
      height: 5px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .status-active {
      color: var(--teal);
      background: var(--teal-dim);
      border-color: var(--teal-border);
      box-shadow: 0 0 10px rgba(0,212,170,0.15);
    }
    .status-active::before { background: var(--teal); box-shadow: 0 0 6px rgba(0,212,170,0.8); }

    .status-watch {
      color: var(--amber);
      background: var(--amber-dim);
      border-color: var(--amber-border);
      box-shadow: 0 0 10px rgba(255,179,0,0.12);
    }
    .status-watch::before { background: var(--amber); box-shadow: 0 0 6px rgba(255,179,0,0.7); animation: dotPulse 2s ease-in-out infinite; }

    .status-risk {
      color: var(--red);
      background: var(--red-dim);
      border-color: var(--red-border);
      box-shadow: 0 0 10px rgba(255,69,96,0.15);
    }
    .status-risk::before { background: var(--red); box-shadow: 0 0 6px rgba(255,69,96,0.8); }

    @keyframes dotPulse {
      0%, 100% { opacity: 1; }
      50%       { opacity: 0.4; }
    }

    /* ═══════════════════════
       FORMS & INPUTS (Dark)
    ═══════════════════════ */
    .toolbar {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      margin-bottom: 14px;
      align-items: end;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .field label {
      font-size: 0.71rem;
      color: var(--t2);
      text-transform: uppercase;
      letter-spacing: 0.09em;
      font-weight: 600;
    }

    .field input,
    .field select {
      width: 100%;
      border: 1px solid var(--b2);
      border-radius: 8px;
      background: var(--s3);
      color: var(--t0);
      padding: 10px 12px;
      font-size: 0.9rem;
      font-family: inherit;
      transition: border-color 140ms ease, box-shadow 140ms ease;
    }

    .field input::placeholder { color: var(--t3); }
    .field select option { background: var(--s3); color: var(--t0); }

    .field input:focus,
    .field select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(255,157,0,0.18);
    }

    .button {
      border: 0;
      background: var(--accent);
      color: #000;
      font-weight: 700;
      border-radius: 8px;
      padding: 10px 18px;
      cursor: pointer;
      white-space: nowrap;
      transition: background 150ms ease, transform 150ms ease, box-shadow 150ms ease;
      font-family: inherit;
      font-size: 0.88rem;
      letter-spacing: 0.04em;
    }

    .button:hover {
      background: #ffb020;
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(255,157,0,0.35);
    }

    .button:active { transform: translateY(0); }

    /* ═══════════════════════
       COUNTRY EXPLORER
    ═══════════════════════ */
    .country-head {
      margin: 4px 0 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      padding-bottom: 14px;
      border-bottom: 1px solid var(--b1);
    }

    .country-title {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--t0);
      letter-spacing: -0.02em;
    }

    #countryBadges .chip {
      border: 1px solid var(--b2);
      background: var(--s4);
      color: var(--t1);
    }

    #countryBadges .chip b { color: var(--t0); }

    /* ── Premium Country Search ── */
    .country-search {
      position: relative;
      max-width: 640px;
      margin-bottom: 22px;
    }

    .cs-label {
      display: block;
      font-size: 0.7rem;
      color: var(--t2);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .cs-input-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--s3);
      border: 1.5px solid var(--b2);
      border-radius: 10px;
      padding: 0 14px;
      transition: border-color 140ms ease, box-shadow 140ms ease;
    }

    .cs-input-wrap:focus-within {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(255,157,0,0.18);
      outline: none;
    }

    .cs-search-icon {
      flex-shrink: 0;
      color: var(--t3);
      width: 17px;
      height: 17px;
      pointer-events: none;
    }

    #countryInput {
      flex: 1;
      border: 0;
      background: transparent;
      padding: 13px 0;
      font-size: 0.97rem;
      font-family: inherit;
      color: var(--t0);
      outline: none;
    }

    #countryInput::placeholder { color: var(--t3); }

    .cs-clear {
      display: none;
      background: none;
      border: 0;
      color: var(--t3);
      font-size: 1rem;
      line-height: 1;
      cursor: pointer;
      padding: 4px;
      border-radius: 50%;
      transition: background 120ms, color 120ms;
    }

    .cs-clear:hover { background: rgba(255,255,255,0.08); color: var(--t1); }
    .country-search.has-value .cs-clear { display: flex; }

    .cs-dropdown {
      position: absolute;
      top: calc(100% + 7px);
      left: 0;
      right: 0;
      background: #0d1020;
      border: 1px solid var(--b2);
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.7), 0 4px 16px rgba(0,0,0,0.4);
      overflow: hidden;
      z-index: 200;
      animation: csDropIn 150ms ease both;
    }

    @keyframes csDropIn {
      from { opacity: 0; transform: translateY(-8px) scale(0.99); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }

    .cs-section-label {
      padding: 9px 14px 6px;
      font-size: 0.61rem;
      letter-spacing: 0.13em;
      text-transform: uppercase;
      color: rgba(255,157,0,0.6);
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
      border-bottom: 1px solid var(--b1);
    }

    .cs-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .cs-item {
      display: flex;
      align-items: center;
      gap: 11px;
      padding: 10px 14px;
      cursor: pointer;
      font-size: 0.92rem;
      color: var(--t1);
      border-bottom: 1px solid var(--b0);
      transition: background 90ms ease;
      user-select: none;
    }

    .cs-item:last-child { border-bottom: 0; }

    .cs-item:hover,
    .cs-item.cs-focused {
      background: rgba(255,157,0,0.1);
      color: #fff;
    }

    .cs-item .cs-flag { font-size: 1.2rem; flex-shrink: 0; width: 24px; text-align: center; }
    .cs-item .cs-name { flex: 1; font-weight: 500; }
    .cs-item .cs-name em { font-style: normal; color: var(--accent); font-weight: 700; }

    .cs-item .cs-tag {
      font-size: 0.65rem;
      background: rgba(255,157,0,0.12);
      color: rgba(255,157,0,0.8);
      border-radius: 4px;
      padding: 2px 7px;
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
      white-space: nowrap;
    }

    .cs-no-results { padding: 18px 14px; color: var(--t3); font-size: 0.88rem; text-align: center; }

    /* ═══════════════════════
       TABLES
    ═══════════════════════ */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.84rem;
      color: var(--t1);
    }

    th, td {
      border-bottom: 1px solid var(--b0);
      padding: 10px 10px;
      text-align: left;
      vertical-align: top;
    }

    th {
      position: sticky;
      top: 0;
      z-index: 1;
      background: #080b15;
      color: rgba(255,255,255,0.55);
      font-size: 0.69rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-weight: 600;
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
      border-bottom: 1px solid var(--b2);
    }

    tbody tr { transition: background 100ms ease; }
    tbody tr:hover { background: var(--s4); }

    /* Rate cell heat coloring — applied via JS or inline style */
    td.rate-low    { color: var(--teal); font-weight: 600; font-family: "IBM Plex Mono", monospace; }
    td.rate-mid    { color: var(--amber); font-weight: 600; font-family: "IBM Plex Mono", monospace; }
    td.rate-high   { color: var(--accent); font-weight: 600; font-family: "IBM Plex Mono", monospace; }
    td.rate-danger { color: var(--red); font-weight: 700; font-family: "IBM Plex Mono", monospace; }

    .table-wrap {
      border: 1px solid var(--b1);
      border-radius: 12px;
      overflow: auto;
      max-height: 450px;
      background: var(--s2);
    }

    /* ═══════════════════════
       SOURCES & LINKS
    ═══════════════════════ */
    .sources {
      margin-top: 14px;
      border: 1px solid var(--b1);
      border-radius: 12px;
      background: var(--s2);
      padding: 12px 14px;
    }

    .sources ul {
      margin: 0;
      padding-left: 18px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 7px 14px;
    }

    .sources a,
    .source-list a,
    .table-wrap a,
    .panel a {
      color: var(--blue);
      text-decoration: none;
      border-bottom: 1px solid rgba(91,155,255,0.28);
      transition: color 120ms, border-color 120ms;
    }

    .sources a:hover,
    .source-list a:hover,
    .table-wrap a:hover,
    .panel a:hover {
      color: #7aaeff;
      border-bottom-color: #7aaeff;
    }

    /* ═══════════════════════
       TIMELINE
    ═══════════════════════ */
    .timeline {
      position: relative;
      margin: 0;
      padding-left: 26px;
      list-style: none;
    }

    .timeline::before {
      content: "";
      position: absolute;
      left: 7px;
      top: 8px;
      bottom: 8px;
      width: 2px;
      background: linear-gradient(180deg, var(--accent) 0%, rgba(255,157,0,0.2) 100%);
      border-radius: 2px;
    }

    .event {
      list-style: none;
      position: relative;
      padding: 0 0 18px 18px;
      margin: 0;
    }

    .event::before {
      content: "";
      position: absolute;
      left: -21px;
      top: 6px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(255,157,0,0.7), 0 0 20px rgba(255,157,0,0.3);
      border: 2px solid var(--s1);
    }

    .event .date {
      font-size: 0.7rem;
      color: var(--amber);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 4px;
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
      font-weight: 600;
    }

    .event .desc {
      margin: 0;
      color: var(--t0);
      font-size: 0.92rem;
      line-height: 1.48;
    }

    .event .meta {
      margin-top: 5px;
      font-size: 0.8rem;
      color: var(--t2);
    }

    .event-badge {
      display: inline-flex;
      align-items: center;
      font-size: 0.62rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      border-radius: 4px;
      padding: 2px 7px;
      font-family: "IBM Plex Mono", monospace;
      margin-bottom: 5px;
      border: 1px solid transparent;
    }

    .badge-232  { color: var(--accent); background: var(--accent-dim); border-color: var(--accent-border); }
    .badge-301  { color: var(--red);    background: var(--red-dim);    border-color: var(--red-border);    }
    .badge-122  { color: var(--blue);   background: var(--blue-dim);   border-color: var(--blue-border);   }
    .badge-ieepa{ color: var(--t2);     background: rgba(255,255,255,0.05); border-color: var(--b2);       }
    .badge-ret  { color: var(--teal);   background: var(--teal-dim);   border-color: var(--teal-border);   }
    .badge-scotus{ color: var(--amber); background: var(--amber-dim);  border-color: var(--amber-border);  }

    /* ═══════════════════════
       SOURCE LIST
    ═══════════════════════ */
    .source-list {
      border: 1px solid var(--b1);
      border-radius: 12px;
      background: var(--s2);
      padding: 14px;
    }

    .source-list ol {
      margin: 0;
      padding-left: 18px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 9px 16px;
    }

    .source-list li {
      color: var(--t1);
      font-size: 0.85rem;
      line-height: 1.48;
    }

    /* ═══════════════════════
       LIVE FEEDS
    ═══════════════════════ */
    .feed-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .feed-meta {
      margin-top: 9px;
      color: var(--t2);
      font-size: 0.83rem;
    }

    .compact th, .compact td { font-size: 0.79rem; padding: 7px 8px; }

    /* ═══════════════════════
       CALCULATOR
    ═══════════════════════ */
    .calc-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 12px;
      margin-top: 12px;
    }

    .calc-form {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 12px;
    }

    .check-grid {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      border: 1px solid var(--b1);
      border-radius: 10px;
      padding: 12px;
      background: var(--s3);
    }

    .check {
      display: inline-flex;
      align-items: flex-start;
      gap: 8px;
      color: var(--t1);
      font-size: 0.84rem;
      line-height: 1.4;
    }

    .check input { margin-top: 2px; accent-color: var(--accent); }

    .calc-summary {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 12px;
    }

    .metric {
      border: 1px solid var(--b1);
      border-radius: 10px;
      background: var(--s3);
      padding: 10px 12px;
    }

    .metric .label {
      color: var(--t2);
      font-size: 0.69rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      margin-bottom: 5px;
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
    }

    .metric .value {
      color: var(--t0);
      font-size: 1.05rem;
      font-weight: 700;
      line-height: 1.24;
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
    }

    /* ═══════════════════════
       GAPS & FOOTER
    ═══════════════════════ */
    .gaps {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .footer-note {
      margin-top: 16px;
      color: var(--t3);
      font-size: 0.78rem;
      line-height: 1.6;
      border-top: 1px solid var(--b1);
      padding-top: 12px;
    }

    /* ═══════════════════════
       RISK / BREAKING BADGES
    ═══════════════════════ */
    .risk-high   { color: var(--red);   font-weight: 700; }
    .risk-medium { color: var(--amber); font-weight: 600; }
    .risk-low    { color: var(--teal);  font-weight: 600; }

    .breaking-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: var(--red);
      color: #fff;
      font-size: 0.65rem;
      font-weight: 800;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      border-radius: 4px;
      padding: 2px 8px;
      flex-shrink: 0;
      box-shadow: 0 0 12px rgba(255,69,96,0.5);
      animation: breakingPulse 2s ease-in-out infinite;
    }

    @keyframes breakingPulse {
      0%, 100% { box-shadow: 0 0 12px rgba(255,69,96,0.5); }
      50%       { box-shadow: 0 0 6px rgba(255,69,96,0.25); }
    }

    /* ═══════════════════════
       KEYFRAMES
    ═══════════════════════ */
    @keyframes tickerSlide {
      from { transform: translateX(0); }
      to   { transform: translateX(-50%); }
    }

    @keyframes riseIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ═══════════════════════
       REDUCED MOTION
    ═══════════════════════ */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* ═══════════════════════
       RESPONSIVE
    ═══════════════════════ */
    @media (max-width: 1200px) {
      .cards-3 { grid-template-columns: 1fr; }
      .kpi-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    @media (max-width: 1100px) {
      .feed-grid,
      .calc-grid,
      .calc-form,
      .check-grid,
      .calc-summary,
      .gaps,
      .source-list ol,
      .sources ul { grid-template-columns: 1fr; }
      .kpi-grid { grid-template-columns: 1fr; }
      .ticker-window { max-width: 100%; }
    }

    @media (max-width: 820px) {
      .shell { padding: 0 10px 40px; }
      .header { padding: 12px 14px 0; border-radius: 0 0 14px 14px; }
      .view { padding: 16px; }
      .title-row { margin-top: 14px; }
      h1 { font-size: clamp(1.5rem, 7vw, 2rem); }
      .fnkeys { grid-template-columns: repeat(3, 1fr); }
      .fnkey { border-right: 1px solid var(--b0); border-bottom: 1px solid var(--b0); padding: 9px 4px 8px; }
      .fn-label { font-size: 0.61rem; }
      .toolbar { grid-template-columns: 1fr; }
      th, td { font-size: 0.78rem; }
      .legal-alert p { font-size: 0.88rem; }
      .kpi .value { font-size: 1.35rem; }
    }


    /* ── 480px — Small phones ── */
    @media (max-width: 480px) {
      .shell { padding: 0 8px 36px; }
      .header { padding: 10px 12px 0; }
      h1 { font-size: clamp(1.3rem, 8vw, 1.7rem); }
      .fnkeys { grid-template-columns: repeat(3, 1fr); }
      .fn-label { font-size: 0.56rem; letter-spacing: 0.04em; }
      .fn-num   { font-size: 0.52rem; }
      .kpi-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
      .kpi { min-height: 76px; padding: 10px 10px; }
      .kpi .value { font-size: 1.2rem; }
      .kpi .label { font-size: 0.62rem; }
      .cards-3 { grid-template-columns: 1fr; gap: 10px; }
      .view { padding: 12px; border-radius: 10px; }
      .section-title { font-size: 1.05rem; }
      .legal-alert { padding: 10px 12px; }
      .legal-alert p { font-size: 0.82rem; line-height: 1.5; }
      .countdown-bar { padding: 7px 10px; gap: 8px; flex-wrap: wrap; }
      .countdown-bar .timer { font-size: 0.88rem; }
      .chips { gap: 5px; }
      .chip { font-size: 0.72rem; padding: 4px 9px; }
      .table-wrap { max-height: 320px; border-radius: 8px; }
      th, td { font-size: 0.74rem; padding: 8px 7px; }
      .timeline { padding-left: 18px; }
      .event { padding: 0 0 16px 12px; }
      .event::before { left: -14px; width: 8px; height: 8px; }
      .calc-grid, .calc-form, .check-grid, .calc-summary, .gaps { grid-template-columns: 1fr; }
      .source-list ol { grid-template-columns: 1fr; }
      .button { padding: 12px 16px; font-size: 0.85rem; min-height: 44px; }
      .cs-dropdown { border-radius: 10px; }
      .cs-list { max-height: 220px; }
      .panel h3 { font-size: 0.82rem; }
      .panel li { padding: 8px 9px; }
      .panel p, .panel li { font-size: 0.83rem; }
      .terminal-strip { flex-direction: column; align-items: flex-start; gap: 6px; }
      .ticker-window { max-width: 100%; width: 100%; }
    }

    /* ═══════════════════════════════════════════════
       THEME TOGGLE
    ═══════════════════════════════════════════════ */
    .theme-toggle {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 999px;
      padding: 6px 13px 6px 10px;
      cursor: pointer;
      color: rgba(255,255,255,0.85);
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-family: inherit;
      transition: background 150ms, border-color 150ms, color 150ms, transform 120ms;
      white-space: nowrap;
      flex-shrink: 0;
      min-height: 34px;
    }

    .theme-toggle:hover {
      background: rgba(255,157,0,0.2);
      border-color: rgba(255,157,0,0.5);
      color: #fff;
      transform: translateY(-1px);
    }

    .theme-toggle:active { transform: translateY(0); }
    .theme-toggle svg { width: 15px; height: 15px; flex-shrink: 0; }
    .theme-toggle .icon-sun  { display: none; }
    .theme-toggle .icon-moon { display: block; }
    [data-theme="light"] .theme-toggle .icon-sun  { display: block; }
    [data-theme="light"] .theme-toggle .icon-moon { display: none; }

    [data-theme="light"] .theme-toggle {
      background: rgba(0,0,0,0.06);
      border-color: rgba(0,0,0,0.18);
      color: rgba(0,0,0,0.7);
    }

    [data-theme="light"] .theme-toggle:hover {
      background: rgba(255,157,0,0.14);
      border-color: rgba(255,157,0,0.5);
      color: #000;
    }

    /* ═══════════════════════════════════════════════
       LIGHT MODE
    ═══════════════════════════════════════════════ */
    [data-theme="light"] {
      --s0: #f4f6fb;
      --s1: #ffffff;
      --s2: #f0f2f8;
      --s3: #e8ebf3;
      --s4: #dde1ed;
      --s5: #d0d5e5;
      --b0: rgba(0,0,0,0.055);
      --b1: rgba(0,0,0,0.10);
      --b2: rgba(0,0,0,0.17);
      --b3: rgba(0,0,0,0.26);
      --t0: #0c1020;
      --t1: rgba(12,16,32,0.78);
      --t2: rgba(12,16,32,0.52);
      --t3: rgba(12,16,32,0.34);
      --text: #0c1020;
      --muted: rgba(12,16,32,0.52);
      --surface: #f0f2f8;
      --surface-soft: #e8ebf3;
      --surface-border: rgba(0,0,0,0.10);
      --surface-border-2: rgba(0,0,0,0.055);
      --shadow: 0 16px 48px rgba(0,0,0,0.10), 0 4px 12px rgba(0,0,0,0.06);
      color-scheme: light;
    }

    [data-theme="light"] body { background: var(--s0); color: var(--t0); }
    [data-theme="light"] body::before {
      background:
        radial-gradient(ellipse 70% 45% at 12% 0%, rgba(255,157,0,0.06) 0%, transparent 55%),
        radial-gradient(ellipse 55% 40% at 92% 0%, rgba(0,40,140,0.04) 0%, transparent 55%);
    }
    [data-theme="light"] body::after { opacity: 0.12; }

    /* Header stays dark */
    [data-theme="light"] .header {
      background: linear-gradient(128deg, #05060d 0%, #0d1020 52%, #101525 100%);
      border-color: rgba(255,255,255,0.1);
    }

    [data-theme="light"] .view { background: var(--s1); border-color: var(--b1); }
    [data-theme="light"] .panel { background: linear-gradient(160deg,#fff 0%,var(--s2) 100%); border-color: var(--b1); }
    [data-theme="light"] .panel::before { background: none; }
    [data-theme="light"] .panel:hover { box-shadow: 0 10px 28px rgba(0,0,0,0.1), 0 0 0 1px rgba(255,157,0,0.18); }
    [data-theme="light"] .panel h3 { color: var(--t0); }
    [data-theme="light"] .panel p, [data-theme="light"] .panel li { color: var(--t1); }
    [data-theme="light"] .panel li { background: rgba(0,0,0,0.025); border-color: var(--b0); }
    [data-theme="light"] .panel li strong { color: var(--t0); }

    [data-theme="light"] .section-title { color: var(--t0); }
    [data-theme="light"] .small-note    { color: var(--t2); }

    [data-theme="light"] .kpi { background: #fff; border-color: var(--b1); }
    [data-theme="light"] .kpi::after { background: none; }
    [data-theme="light"] .kpi .label { color: var(--t2); }
    [data-theme="light"] .kpi .value { color: var(--t0); }
    [data-theme="light"] .kpi .sub   { color: #00836a; }

    [data-theme="light"] .table-wrap { background: #fff; border-color: var(--b1); }
    [data-theme="light"] table  { color: var(--t0); }
    [data-theme="light"] td     { border-color: var(--b0); color: var(--t1); }
    [data-theme="light"] td strong { color: var(--t0); }
    [data-theme="light"] tbody tr:hover { background: var(--s3); }
    [data-theme="light"] th { background: #1a1e2e; color: rgba(255,255,255,0.72); border-color: rgba(255,255,255,0.08); }

    [data-theme="light"] td.rate-low    { color: #00836a; }
    [data-theme="light"] td.rate-mid    { color: #b07800; }
    [data-theme="light"] td.rate-high   { color: #c45500; }
    [data-theme="light"] td.rate-danger { color: #c40038; }

    [data-theme="light"] .status-active { color: #006f48; background: rgba(0,180,130,0.1); border-color: rgba(0,180,130,0.3); box-shadow: none; }
    [data-theme="light"] .status-watch  { color: #825500; background: rgba(255,170,0,0.1); border-color: rgba(255,170,0,0.3); box-shadow: none; }
    [data-theme="light"] .status-risk   { color: #9e0028; background: rgba(220,30,60,0.08); border-color: rgba(220,30,60,0.25); box-shadow: none; }
    [data-theme="light"] .status-active::before { box-shadow: none; }
    [data-theme="light"] .status-watch::before  { box-shadow: none; animation: none; }
    [data-theme="light"] .status-risk::before   { box-shadow: none; }

    [data-theme="light"] .field input,
    [data-theme="light"] .field select { background: #fff; border-color: var(--b2); color: var(--t0); }
    [data-theme="light"] .field input::placeholder { color: var(--t3); }
    [data-theme="light"] .field label { color: var(--t2); }
    [data-theme="light"] .check-grid   { background: var(--s2); border-color: var(--b1); }
    [data-theme="light"] .check        { color: var(--t1); }
    [data-theme="light"] .metric       { background: var(--s2); border-color: var(--b1); }
    [data-theme="light"] .metric .label { color: var(--t2); }
    [data-theme="light"] .metric .value { color: var(--t0); }

    [data-theme="light"] .cs-input-wrap { background: #fff; border-color: var(--b2); }
    [data-theme="light"] .cs-search-icon { color: var(--t3); }
    [data-theme="light"] #countryInput { color: var(--t0); }
    [data-theme="light"] #countryInput::placeholder { color: var(--t3); }
    [data-theme="light"] .cs-label { color: var(--t2); }
    [data-theme="light"] .cs-dropdown { background: #fff; border-color: var(--b2); box-shadow: 0 16px 48px rgba(0,0,0,0.14); }
    [data-theme="light"] .cs-item { color: var(--t1); border-color: var(--b0); }
    [data-theme="light"] .cs-item:hover,
    [data-theme="light"] .cs-item.cs-focused { background: rgba(255,157,0,0.08); color: var(--t0); }
    [data-theme="light"] .cs-section-label { border-color: var(--b1); }
    [data-theme="light"] .cs-no-results { color: var(--t2); }

    [data-theme="light"] .event .desc  { color: var(--t0); }
    [data-theme="light"] .event .date  { color: #9a6200; }
    [data-theme="light"] .event .meta  { color: var(--t2); }
    [data-theme="light"] .timeline::before { background: linear-gradient(180deg, var(--accent) 0%, rgba(255,157,0,0.15) 100%); }

    [data-theme="light"] .source-list,
    [data-theme="light"] .sources  { background: var(--s2); border-color: var(--b1); }
    [data-theme="light"] .source-list li { color: var(--t1); }
    [data-theme="light"] .feed-meta { color: var(--t2); }

    [data-theme="light"] .sources a,
    [data-theme="light"] .source-list a,
    [data-theme="light"] .table-wrap a,
    [data-theme="light"] .panel a { color: #1a52cc; border-bottom-color: rgba(26,82,204,0.28); }
    [data-theme="light"] .sources a:hover,
    [data-theme="light"] .source-list a:hover,
    [data-theme="light"] .table-wrap a:hover,
    [data-theme="light"] .panel a:hover { color: #0d38a0; border-bottom-color: #0d38a0; }

    [data-theme="light"] .country-head  { border-color: var(--b1); }
    [data-theme="light"] .country-title { color: var(--t0); }
    [data-theme="light"] #countryBadges .chip { background: var(--s3); border-color: var(--b2); color: var(--t1); }
    [data-theme="light"] #countryBadges .chip b { color: var(--t0); }

    [data-theme="light"] .footer-note  { color: var(--t2); border-color: var(--b1); }
    [data-theme="light"] .risk-high    { color: #9e0028; }
    [data-theme="light"] .risk-medium  { color: #825500; }
    [data-theme="light"] .risk-low     { color: #006f48; }

    /* ═══════════════════════════════════════════════
       DISCLAIMER FOOTER
    ═══════════════════════════════════════════════ */
    .site-disclaimer {
      margin-top: 28px;
      border: 1.5px solid rgba(255,179,0,0.42);
      border-radius: 14px;
      background: linear-gradient(160deg, rgba(255,157,0,0.07) 0%, rgba(255,157,0,0.02) 100%);
      overflow: hidden;
    }

    .disclaimer-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 18px;
      background: rgba(255,157,0,0.11);
      border-bottom: 1px solid rgba(255,179,0,0.28);
      flex-wrap: wrap;
    }

    .disclaimer-header .disc-icon { font-size: 1.1rem; flex-shrink: 0; }

    .disclaimer-header strong {
      font-size: 0.78rem;
      font-weight: 800;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--amber);
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
    }

    .disclaimer-body { padding: 16px 18px 12px; }

    .disclaimer-body p {
      margin: 0 0 9px;
      font-size: 0.84rem;
      color: var(--t1);
      line-height: 1.62;
    }

    .disclaimer-body p:last-child { margin-bottom: 0; }
    .disclaimer-body strong { color: var(--t0); font-weight: 600; }

    .disclaimer-body ul {
      margin: 6px 0 10px;
      padding-left: 18px;
    }

    .disclaimer-body ul li {
      font-size: 0.83rem;
      color: var(--t1);
      line-height: 1.58;
      margin-bottom: 4px;
    }

    .disclaimer-stamp {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 10px 18px;
      border-top: 1px solid rgba(255,179,0,0.22);
      background: rgba(0,0,0,0.16);
    }

    .disclaimer-stamp span {
      font-size: 0.72rem;
      color: var(--t2);
      font-family: "IBM Plex Mono", Menlo, Consolas, monospace;
    }

    .stamp-tag {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: rgba(255,179,0,0.12);
      border: 1px solid rgba(255,179,0,0.32);
      border-radius: 4px;
      padding: 2px 9px;
      color: var(--amber);
      font-size: 0.67rem;
      font-weight: 700;
      letter-spacing: 0.09em;
      text-transform: uppercase;
    }

    [data-theme="light"] .site-disclaimer { background: linear-gradient(160deg, rgba(255,157,0,0.06) 0%, rgba(255,157,0,0.01) 100%); border-color: rgba(200,140,0,0.35); }
    [data-theme="light"] .disclaimer-header { background: rgba(255,157,0,0.09); border-color: rgba(200,140,0,0.25); }
    [data-theme="light"] .disclaimer-body p { color: var(--t1); }
    [data-theme="light"] .disclaimer-body li { color: var(--t1); }
    [data-theme="light"] .disclaimer-body strong { color: var(--t0); }
    [data-theme="light"] .disclaimer-stamp { background: rgba(0,0,0,0.04); border-color: rgba(200,140,0,0.18); }
    [data-theme="light"] .disclaimer-stamp span { color: var(--t2); }

  </style>
</head>
<body>
  <div class="shell">
    <header class="header">
      <div class="terminal-strip">
        <div class="terminal-meta">
          <span class="terminal-pill"><span class="terminal-led"></span>Live Procurement Signals</span>
          <span class="terminal-pill">Bloomberg-Inspired UI</span>
          <span class="terminal-pill">U.S. Tariff Intelligence</span>
        </div>
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle light/dark mode">
          <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
          <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
          <span id="themeLabel">Light</span>
        </button>
        <div class="ticker-window" aria-label="Live headline ticker">
          <div class="ticker-track" id="headlineTicker">
            <span class="ticker-item">Initializing official-source tariff headline feed</span>
            <span class="ticker-item">Loading CBP CSMS operational updates</span>
            <span class="ticker-item">Loading Federal Register trade notices</span>
            <span class="ticker-item">Initializing official-source tariff headline feed</span>
            <span class="ticker-item">Loading CBP CSMS operational updates</span>
            <span class="ticker-item">Loading Federal Register trade notices</span>
          </div>
        </div>
      </div>
      <div class="title-row">
        <div>
          <p class="hero-kicker">Global Tariff Command Center</p>
          <h1>US Tariff Intelligence Desk</h1>
          <div class="chips">
            <span class="chip"><span class="chip-dot"></span><b>Last verified:</b> <span id="lastVerified">2026-02-21</span></span>
            <span class="chip"><b>Audience:</b> Siemens Healthineers Procurement</span>
            <span class="chip"><b>Coverage:</b> U.S. tariffs + countermeasures</span>
            <span class="chip"><span class="breaking-badge">BREAKING</span><b>Section 122:</b> 15% global tariff effective <b>Feb 24, 2026</b></span>
          </div>
          <div class="countdown-bar">
            <span class="label">Section 122 expiry countdown (150 days from Feb 24)</span>
            <span class="timer" id="section122Countdown">Calculating...</span>
            <span class="label">— Congressional approval needed to extend beyond Jul 24, 2026</span>
          </div>
        </div>
      </div>
      <div class="legal-alert">
        <p><strong>⚡ BREAKING Feb 21, 2026 — New 15% Global Tariff Under Section 122:</strong> After the U.S. Supreme Court struck down IEEPA tariffs on <strong>Feb 20, 2026</strong> (24-1287, <em>Learning Resources, Inc. v. Trump</em>, 6-3 ruling), President Trump signed a <strong>15% temporary global import surcharge</strong> on all countries under Section 122 of the Trade Act of 1974 — effective <strong>Feb 24, 2026 at 00:01 ET</strong> for up to 150 days (expires ~July 24, 2026; extension requires Congressional approval). <strong>Exceptions:</strong> pharmaceuticals, certain agricultural products (beef, tomatoes, oranges), critical minerals &amp; metals, some electronics. <strong>Section 232 tariffs</strong> (steel 50%, aluminum 50%, autos 25%, semiconductors 25%, copper 50%) and <strong>Section 301</strong> (China strategic) remain fully active and were unaffected by the SCOTUS ruling. Confirm operative tariff layer with your customs broker before any PO release or shipment booking after Feb 24.</p>
      </div>
      <div class="kpi-grid" id="kpiGrid"></div>
      <nav class="fnkeys" aria-label="Primary views">
        <button class="fnkey active" data-view-target="dashboard">
          <span class="fn-num">01</span>
          <span class="fn-label">Dashboard</span>
        </button>
        <button class="fnkey" data-view-target="sh-impact">
          <span class="fn-num">02</span>
          <span class="fn-label">SHS Impact</span>
        </button>
        <button class="fnkey" data-view-target="country">
          <span class="fn-num">03</span>
          <span class="fn-label">Country</span>
        </button>
        <button class="fnkey" data-view-target="commodities">
          <span class="fn-num">04</span>
          <span class="fn-label">Commodity</span>
        </button>
        <button class="fnkey" data-view-target="timeline">
          <span class="fn-num">05</span>
          <span class="fn-label">Timeline</span>
        </button>
        <button class="fnkey" data-view-target="live">
          <span class="fn-num">06</span>
          <span class="fn-label">Live Feeds</span>
        </button>
        <button class="fnkey" data-view-target="calculator">
          <span class="fn-num">07</span>
          <span class="fn-label">Calculator</span>
        </button>
        <button class="fnkey" data-view-target="sources">
          <span class="fn-num">08</span>
          <span class="fn-label">Sourcebook</span>
        </button>
        <button class="fnkey" data-view-target="gaps">
          <span class="fn-num">09</span>
          <span class="fn-label">Gaps</span>
        </button>
      </nav>
    </header>

    <section class="view active" data-view="dashboard">
      <h2 class="section-title">Executive Snapshot — As of Feb 21, 2026</h2>
      <p class="small-note">This view separates <strong>active trade measures</strong> from <strong>contested/conditional measures</strong> and highlights the highest procurement-impact categories for Siemens Healthineers global sourcing teams.</p>
      <div class="cards-3">
        <article class="panel panel-teal">
          <h3>Active Tariff Regimes (Confirmed)</h3>
          <ul>
            <li><strong>Section 232 Steel/Aluminum:</strong> 50% on all countries (UK 25%). Eff. Jun 4, 2025. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.federalregister.gov/documents/2025/06/09/2025-10524/adjusting-imports-of-aluminum-and-steel-into-the-united-states" target="_blank" rel="noopener">FR Proc. 10947</a>]</span></li>
            <li><strong>Section 232 Autos &amp; Parts:</strong> 25% on passenger vehicles. Eff. Apr 3, 2025. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.federalregister.gov/documents/2025/04/03/2025-05930/adjusting-imports-of-automobiles-and-automobile-parts-into-the-united-states" target="_blank" rel="noopener">FR Proc. 10908</a>]</span></li>
            <li><strong>Section 232 Semiconductors:</strong> 25% on covered chips and SME. Eff. Jan 15, 2026. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.federalregister.gov/documents/2026/01/20/2026-01052/adjusting-imports-of-semiconductors-semiconductor-manufacturing-equipment-and-their-derivative" target="_blank" rel="noopener">FR Proc. 11002</a>]</span></li>
            <li><strong>Section 232 Copper:</strong> 50% on semi-finished copper derivatives. Eff. Aug 1, 2025. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.federalregister.gov/documents/2025/08/05/2025-14893/adjusting-imports-of-copper-into-the-united-states" target="_blank" rel="noopener">FR Proc. 10962</a>]</span></li>
            <li><strong>Section 301 China Strategic:</strong> Elevated duties on EVs, batteries, solar, cranes, selected medical products. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://ustr.gov/about-us/policy-offices/press-office/press-releases/2024/may/ustr-finalizes-tariff-increases-chinese-products-electric-vehicles-batteries-solar-cells-critical-minerals-medicals-and" target="_blank" rel="noopener">USTR 2024</a>]</span></li>
            <li><strong>Section 122 Global Surcharge:</strong> 15% on ALL countries. Effective Feb 24, 2026. 150-day limit (~Jul 24). Pharma, certain ag, critical minerals exempt. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.whitehouse.gov/fact-sheets/2026/02/fact-sheet-president-donald-j-trump-imposes-a-temporary-import-duty-to-address-fundamental-international-payment-problems/" target="_blank" rel="noopener">White House Fact Sheet</a>] [<a href="https://www.axios.com/2026/02/20/trump-tariff-plan-section-122-trade-act" target="_blank" rel="noopener">Axios</a>]</span></li>
            <li><strong>Branded Pharma 100%:</strong> 100% tariff on branded/patented drugs (exemption for U.S. manufacturing investment). Eff. Oct 1, 2025. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.aha.org/news/headline/2025-09-26-president-announces-new-tariffs-including-certain-pharmaceuticals-set-begin-oct-1" target="_blank" rel="noopener">AHA/White House</a>]</span></li>
          </ul>
        </article>
        <article class="panel panel-amber">
          <h3>Contested / Under Investigation</h3>
          <ul>
            <li><strong>IEEPA tariffs invalidated:</strong> SCOTUS ruled IEEPA does not authorize broad tariff programs (Feb 20, 2026, 6-3). All IEEPA-derived rates struck down; awaiting CBP unwinding guidance. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.supremecourt.gov/opinions/slipopinion/25" target="_blank" rel="noopener">SCOTUS</a>] [<a href="https://www.scotusblog.com/2026/02/a-breakdown-of-the-courts-tariff-decision/" target="_blank" rel="noopener">SCOTUSblog analysis</a>]</span></li>
            <li><strong>Medical Devices Section 232:</strong> BIS investigation opened Sep 24, 2025. Covers CT/MRI/X-ray, pacemakers, stents, ventilators, PPE. Report due May 30, 2026; President has 90 days to act. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.supplychaindive.com/news/trump-tariffs-medical-devices-equipment-ppe-section-232-investigation/761070/" target="_blank" rel="noopener">Supply Chain Dive</a>] [<a href="https://www.whitecase.com/insight-alert/trump-administration-initiates-section-232-investigation-medical-supplies" target="_blank" rel="noopener">White &amp; Case</a>]</span></li>
            <li><strong>Pharma Section 232:</strong> Investigation ongoing (initiated Apr 1, 2025). Generic/branded APIs, finished drugs, biologics in scope. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.ey.com/en_gl/technical/tax-alerts/us-trade-developments-include-announced-new-tariffs-on-pharmaceuticals-section-232-investigations-into-imports-including-robotics-industrial-machinery-ppe-and-medical-equipment" target="_blank" rel="noopener">EY Global</a>]</span></li>
            <li><strong>Section 122 duration risk:</strong> Section 122 expires ~Jul 24, 2026. Congressional approval required to extend beyond 150 days. If not extended, tariff lapses — creating sourcing volatility. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.axios.com/2026/02/20/trump-tariff-plan-section-122-trade-act" target="_blank" rel="noopener">Axios</a>]</span></li>
            <li><strong>India interim deal:</strong> US-India Interim Agreement reducing IEEPA reciprocal rates to 18% on certain goods — IEEPA component now moot post-SCOTUS, but bilateral deal framework may survive. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://taxfoundation.org/research/all/federal/trump-tariffs-trade-war/" target="_blank" rel="noopener">Tax Foundation tracker</a>]</span></li>
          </ul>
        </article>
        <article class="panel panel-orange">
          <h3>Priority Actions for Procurement</h3>
          <ul>
            <li><strong>Confirm Feb 24 impact:</strong> Run all open POs through the Tariff Calculator with Section 122 (15%) layer for non-exempt commodities. <span style="font-size:0.78rem;color:var(--muted);">[Use Tariff Calculator tab]</span></li>
            <li><strong>Pharma/API sourcing:</strong> Verify supplier country and product classification — UK has 0% pharma deal. Branded pharma 100% tariff already active. Generic APIs face Section 232 investigation risk. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.federalregister.gov/documents/2025/06/23/2025-11473/implementing-the-general-terms-of-the-united-states-of-america-united-kingdom-economic-prosperity" target="_blank" rel="noopener">UK deal FR</a>]</span></li>
            <li><strong>Imaging supply chain:</strong> CT, MRI, X-ray components face Section 232 (steel 50% / semi 25%) + Section 122 (15%) + potential Medical Devices Section 232 by mid-2026 (up to +25% more). <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.bloomberg.com/news/articles/2025-11-05/siemens-healthineers-sees-tariff-impact-doubling-in-fiscal-2026" target="_blank" rel="noopener">Bloomberg SHS impact</a>]</span></li>
            <li><strong>Steel/copper contracts:</strong> Re-confirm force-majeure and price-escalation clauses — 50% steel/copper rates fully active since Jun/Aug 2025, not disputed by SCOTUS ruling. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://www.cnbc.com/2026/02/20/trump-tariffs-supreme-court-ruling-industry-higher-rates.html" target="_blank" rel="noopener">CNBC — industries still facing higher rates</a>]</span></li>
            <li><strong>China exposure:</strong> Section 301 strategic tariffs remain fully active and unaffected by SCOTUS ruling. Anti-circumvention enforcement (melt-and-pour, transshipment) actively enforced. <span style="font-size:0.78rem;color:var(--muted);">[<a href="https://ustr.gov/about-us/policy-offices/press-office/press-releases/2024/may/ustr-finalizes-tariff-increases-chinese-products-electric-vehicles-batteries-solar-cells-critical-minerals-medicals-and" target="_blank" rel="noopener">USTR Section 301</a>]</span></li>
            <li><strong>Monitor GAPS tab:</strong> Retaliation schedules for India, Japan, EU, South Korea still incomplete. SHS category-level SKU mapping not built. Medical Devices S.232 report due May 30 — critical watch date. <span style="font-size:0.78rem;color:var(--muted);">[Gaps tab]</span></li>
          </ul>
        </article>
      </div>
    </section>

    <section class="view" data-view="sh-impact">
      <h2 class="section-title">Siemens Healthineers — Tariff Impact Intelligence</h2>
      <p class="small-note">This view consolidates tariff exposure specific to Siemens Healthineers (SHS) product portfolio and procurement categories. Data sourced from SHS investor disclosures, Bloomberg, MedTech Dive, and regulatory filings. <strong>For internal procurement planning only.</strong></p>
      <div class="cards-3">
        <article class="panel panel-orange">
          <h3>Financial Impact Overview</h3>
          <ul>
            <li><strong>FY2025 tariff hit:</strong> ~€200M actual impact on earnings.<br/><span style="font-size:0.8rem;color:var(--muted);">Source: <a href="https://www.medtechdive.com/news/siemens-healthineers-predicts-tariff-impact-will-double/804834/" target="_blank" rel="noopener">MedTech Dive, Nov 2025</a></span></li>
            <li><strong>FY2026 projected impact:</strong> €400M (~$460M) — double FY2025.<br/><span style="font-size:0.8rem;color:var(--muted);">Source: <a href="https://www.bloomberg.com/news/articles/2025-11-05/siemens-healthineers-sees-tariff-impact-doubling-in-fiscal-2026" target="_blank" rel="noopener">Bloomberg, Nov 5 2025</a></span></li>
            <li><strong>Mitigation spend:</strong> €200–300M planned for production relocation and supplier diversification.<br/><span style="font-size:0.8rem;color:var(--muted);">Source: <a href="https://radiologybusiness.com/topics/healthcare-management/healthcare-economics/tariffs-not-enough-make-siemens-healthineers-move-production-or-raise-prices-yet" target="_blank" rel="noopener">Radiology Business, 2025</a></span></li>
            <li><strong>Impact split:</strong> Imaging and Advanced Therapies segments most exposed; Varian and Diagnostics comparatively lower impact.</li>
          </ul>
        </article>
        <article class="panel panel-red">
          <h3>Product Categories at Risk</h3>
          <ul>
            <li><strong>Computed Tomography (CT):</strong> Steel/aluminum chassis components (Section 232 50%); semiconductor detector arrays (Section 232 25%); copper wiring harnesses (Section 232 50%). Additionally under Medical Devices Section 232 investigation.<br/><span style="font-size:0.8rem;color:var(--muted);">Source: <a href="https://www.supplychaindive.com/news/trump-tariffs-medical-devices-equipment-ppe-section-232-investigation/761070/" target="_blank" rel="noopener">Supply Chain Dive</a></span></li>
            <li><strong>MRI Systems:</strong> Superconducting magnets (copper, specialized alloys 50%); electronics (semis 25%); cryogenic components. Same Section 232 medical device probe covers MRI.<br/><span style="font-size:0.8rem;color:var(--muted);">Source: <a href="https://www.whitecase.com/insight-alert/trump-administration-initiates-section-232-investigation-medical-supplies" target="_blank" rel="noopener">White &amp; Case</a></span></li>
            <li><strong>X-Ray / Angio / PET:</strong> Detector panels, X-ray tubes contain steel frames and semiconductor components. Section 301 (China) applies to sourced electrical components.</li>
            <li><strong>Diagnostics / Lab:</strong> Less affected by current Section 232 programs. However, reagent/API supply chains may hit pharma tariff if derived products are reclassified.</li>
            <li><strong>Varian (Radiation Oncology):</strong> Lower direct tariff exposure per SHS guidance; U.S. manufacturing provides domestic buffer.</li>
          </ul>
        </article>
        <article class="panel panel-teal">
          <h3>Strategic Procurement Signals</h3>
          <ul>
            <li><strong>No price increases yet:</strong> As of mid-2025 SHS had not raised prices, absorbing tariffs in margins — but flagged potential future pass-through.<br/><span style="font-size:0.8rem;color:var(--muted);">Source: <a href="https://radiologybusiness.com/topics/healthcare-management/healthcare-economics/tariffs-not-enough-make-siemens-healthineers-move-production-or-raise-prices-yet" target="_blank" rel="noopener">Radiology Business</a></span></li>
            <li><strong>Production relocation:</strong> SHS is actively evaluating moving production hubs to mitigate tariff exposure, though no confirmed moves as of Feb 2026.</li>
            <li><strong>Supplier diversification:</strong> Actively building second-source supply chains away from China for electronics, metals, and components.</li>
            <li><strong>UK pharma deal advantage:</strong> SHS diagnostics reagents/kits sourced from UK may benefit from 0% pharma tariff under US-UK deal. Confirm HTS classification.<br/><span style="font-size:0.8rem;color:var(--muted);">Source: <a href="https://www.bakerdonelson.com/section-232-update-new-probes-on-medical-devices-robotics-tariffs-on-pharma-more" target="_blank" rel="noopener">Baker Donelson</a></span></li>
            <li><strong>Medical device exemption watch:</strong> Section 232 medical device investigation (report due May 2026) could impose additional tariffs or — if exclusions are granted — provide relief. File comment letters with BIS before public comment deadline.</li>
          </ul>
        </article>
      </div>
      <h3 class="section-title" style="margin-top:16px;">SHS Procurement Category Tariff Exposure Matrix</h3>
      <p class="small-note">Mapping of SHS product/spend categories to applicable tariff regimes. Rates shown are additive where non-stacking rules do not apply.</p>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>SHS Category</th>
              <th>Key Inputs</th>
              <th>Primary Tariff Regime</th>
              <th>Rate Range</th>
              <th>Status</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>CT Systems</td><td>Steel housings, Al gantry, Cu wiring, detector chips</td><td>Section 232 (metal + semi) + Section 122</td><td>25–65%</td><td><span class="status-pill status-risk">HIGH RISK</span></td><td>Medical device S.232 probe adds further upside risk by mid-2026</td></tr>
            <tr><td>MRI Systems</td><td>Superconducting Cu/alloy magnets, electronics</td><td>Section 232 copper + semis + Section 122</td><td>25–65%</td><td><span class="status-pill status-risk">HIGH RISK</span></td><td>Cryogenic supply chain from Germany/Japan</td></tr>
            <tr><td>X-Ray / Angio Equipment</td><td>Steel frames, X-ray tubes, detector arrays</td><td>Section 232 steel/semis + Section 122</td><td>25–65%</td><td><span class="status-pill status-risk">HIGH RISK</span></td><td>China-sourced electrical components carry additional Section 301</td></tr>
            <tr><td>Molecular Imaging (PET/SPECT)</td><td>Electronics, detectors, pharmaceuticals (tracers)</td><td>Section 232 semis + pharma 100% (tracers)</td><td>25–115%</td><td><span class="status-pill status-risk">HIGH RISK</span></td><td>PET tracers may qualify as pharmaceutical — verify HTS class</td></tr>
            <tr><td>Ultrasound Systems</td><td>Transducer elements, electronics, cables</td><td>Section 232 semis + Section 122</td><td>25–40%</td><td><span class="status-pill status-watch">WATCH</span></td><td>Lower metal content; primary exposure is semiconductor components</td></tr>
            <tr><td>Diagnostics / IVD Reagents</td><td>Chemical reagents, APIs, plastics, consumables</td><td>Pharma S.232 investigation; Section 122</td><td>15–100%</td><td><span class="status-pill status-watch">WATCH</span></td><td>Pharma tariff risk if classified as drug product; UK-sourced may qualify for 0%</td></tr>
            <tr><td>Varian Linac / RT Systems</td><td>Electronics, mechanical, steel</td><td>Section 232 steel/semis + Section 122</td><td>25–65%</td><td><span class="status-pill status-watch">WATCH</span></td><td>Significant U.S. domestic manufacturing reduces import exposure</td></tr>
            <tr><td>Service Parts / Spare Parts</td><td>Varies widely by system</td><td>Section 232 applicable by part type + Section 122</td><td>15–65%</td><td><span class="status-pill status-watch">WATCH</span></td><td>Each HTS code must be mapped individually; broker review required</td></tr>
            <tr><td>PPE / Consumables</td><td>Gloves, gowns, masks — primarily China-sourced</td><td>Section 301 (China) + Section 122</td><td>15–80%</td><td><span class="status-pill status-risk">HIGH RISK</span></td><td>In scope of Medical Devices Section 232 investigation (PPE included)</td></tr>
            <tr><td>Raw Materials (Steel, Al, Cu)</td><td>Commodity inputs</td><td>Section 232</td><td>50%</td><td><span class="status-pill status-active">ACTIVE</span></td><td>No country exemptions remain for steel/aluminum (except UK 25%)</td></tr>
          </tbody>
        </table>
      </div>
      <div class="sources" style="margin-top:12px;">
        <h3 class="section-title" style="margin:0 0 8px; font-size:0.95rem;">SHS Impact Sources</h3>
        <ul>
          <li><a href="https://www.bloomberg.com/news/articles/2025-11-05/siemens-healthineers-sees-tariff-impact-doubling-in-fiscal-2026" target="_blank" rel="noopener">Bloomberg: SHS Sees Tariff Impact Doubling in FY2026 (Nov 5, 2025)</a></li>
          <li><a href="https://www.medtechdive.com/news/siemens-healthineers-predicts-tariff-impact-will-double/804834/" target="_blank" rel="noopener">MedTech Dive: SHS Predicts Tariff Impact Will Double</a></li>
          <li><a href="https://www.washingtonpost.com/world/2025/05/25/siemens-medical-devices-trump-tariffs/" target="_blank" rel="noopener">Washington Post: Life-Saving Medical Devices Could Be Imperiled by Tariffs (May 2025)</a></li>
          <li><a href="https://www.supplychaindive.com/news/trump-tariffs-medical-devices-equipment-ppe-section-232-investigation/761070/" target="_blank" rel="noopener">Supply Chain Dive: US Opens Investigation into Medical Equipment Imports</a></li>
          <li><a href="https://www.bakerdonelson.com/section-232-update-new-probes-on-medical-devices-robotics-tariffs-on-pharma-more" target="_blank" rel="noopener">Baker Donelson: Section 232 Update — Medical Devices, Robotics, Pharma Probes</a></li>
          <li><a href="https://www.pwc.com/us/en/services/tax/library/tariff-industry-analysis-pharma-life-science-and-medical-device.html" target="_blank" rel="noopener">PwC: Tariff Industry Analysis — Pharma, Life Science &amp; Medical Device</a></li>
          <li><a href="https://www.fiercebiotech.com/medtech/siemens-healthineers-philips-project-softer-tariff-hit-following-us-eu-deal" target="_blank" rel="noopener">Fierce Biotech: SHS Projects Up to $580M Tariff Hit in FY2026</a></li>
          <li><a href="https://radiologybusiness.com/topics/healthcare-management/healthcare-economics/tariffs-not-enough-make-siemens-healthineers-move-production-or-raise-prices-yet" target="_blank" rel="noopener">Radiology Business: Tariffs Not Yet Enough to Move Production or Raise Prices</a></li>
        </ul>
      </div>
    </section>

    <section class="view" data-view="country">
      <h2 class="section-title">Country Explorer</h2>
      <p class="small-note">Select a country to see currently levied U.S. tariffs (high confidence), contested/conditional programs, country-specific reciprocal rate status, and known countermeasures against U.S. goods.</p>

      <div class="country-search" id="countrySearch">
        <span class="cs-label">Country</span>
        <div class="cs-input-wrap">
          <svg class="cs-search-icon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <circle cx="8.5" cy="8.5" r="5.5"/>
            <line x1="13" y1="13" x2="18" y2="18"/>
          </svg>
          <input id="countryInput" type="text" value="Canada" placeholder="Search any country…" autocomplete="off" spellcheck="false" />
          <button class="cs-clear" id="csClear" aria-label="Clear search" tabindex="-1">
            <svg viewBox="0 0 14 14" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><line x1="1" y1="1" x2="13" y2="13"/><line x1="13" y1="1" x2="1" y2="13"/></svg>
          </button>
        </div>
        <div class="cs-dropdown" id="csDropdown" hidden>
          <div class="cs-section-label" id="csSectionLabel">Featured</div>
          <div class="cs-list" id="csList"></div>
        </div>
      </div>

      <div class="country-head">
        <h3 class="country-title" id="countryTitle">Canada</h3>
        <div id="countryBadges"></div>
      </div>

      <div class="panel" style="margin-bottom:10px;">
        <h3>Country Summary</h3>
        <p id="countrySummaryText"></p>
      </div>

      <h3 class="section-title" style="margin-top:2px;">U.S. Measures For Selected Country</h3>
      <p class="small-note">Rows marked <strong>Active</strong> are currently levied under available official texts. Rows marked <strong>Contested/Conditional</strong> depend on post-ruling enforcement actions or future determinations.</p>
      <div class="table-wrap">
        <table id="usMeasureTable">
          <thead>
            <tr>
              <th>Measure</th>
              <th>Commodity / Product Scope</th>
              <th>Tariff / Treatment</th>
              <th>Status</th>
              <th>Effective</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <h3 class="section-title" style="margin-top:14px;">Countermeasures Against U.S. Goods</h3>
      <div class="table-wrap">
        <table id="retaliationTable">
          <thead>
            <tr>
              <th>Jurisdiction</th>
              <th>Known Countermeasure</th>
              <th>Product Scope</th>
              <th>Status</th>
              <th>Effective / Horizon</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="sources">
        <h3 class="section-title" style="margin:0 0 8px; font-size:0.95rem;">Country Evidence Links</h3>
        <ul id="countrySourceLinks"></ul>
      </div>
    </section>

    <section class="view" data-view="commodities">
      <h2 class="section-title">Commodity Matrix</h2>
      <p class="small-note">Commodity-level map of U.S. measures that matter most for sourcing, landed cost, and contract clauses. This table is prefiltered to trade instruments with explicit Federal Register/White House publication records.</p>
      <div class="table-wrap">
        <table id="commodityTable">
          <thead>
            <tr>
              <th>Commodity Group</th>
              <th>Current U.S. Tariff Condition</th>
              <th>Coverage Notes</th>
              <th>Status</th>
              <th>Primary Sources</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="view" data-view="timeline">
      <h2 class="section-title">Timeline (Key Events)</h2>
      <p class="small-note">Chronology includes issuance and major modifications through February 2026. Dates are shown as absolute dates to prevent interpretation drift.</p>
      <ul class="timeline" id="timelineList"></ul>
    </section>

    <section class="view" data-view="live">
      <h2 class="section-title">Live Feeds (Official Sources)</h2>
      <p class="small-note">Automated intelligence pull from Federal Register API, CBP CSMS, and official retaliation/public-policy feeds. Use this view for daily signal checks and escalation triggers.</p>
      <div class="cards-3" id="liveSummary"></div>
      <div class="feed-grid">
        <article class="panel">
          <h3>Federal Register (Tariff-Relevant)</h3>
          <div class="table-wrap">
            <table class="compact" id="liveFrTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Type</th>
                  <th>Document</th>
                  <th>Query Hit</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </article>
        <article class="panel">
          <h3>CBP CSMS (Operations)</h3>
          <div class="table-wrap">
            <table class="compact" id="liveCbpTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Message</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </article>
      </div>
      <article class="panel" style="margin-top:10px;">
        <h3>Retaliation / Countermeasure Watch</h3>
        <div class="table-wrap">
          <table class="compact" id="liveRetaliationTable">
            <thead>
              <tr>
                <th>Jurisdiction</th>
                <th>Date</th>
                <th>Headline</th>
                <th>Feed</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="feed-meta">Coverage in this build: EU Commission, UK DBT, PRC MOFCOM (English), Canada Finance.</div>
      </article>
      <article class="panel" id="liveFeedErrors" style="margin-top:10px;">
        <h3>Feed Health</h3>
        <p class="small-note" style="margin:0;">Waiting for data load.</p>
      </article>
    </section>

    <section class="view" data-view="calculator">
      <h2 class="section-title">HTS Landed-Cost Calculator</h2>
      <p class="small-note">Estimator for procurement triage. It combines MFN, Section 232/301, and optional contested IEEPA layers with a configurable non-stacking simplification.</p>
      <div class="calc-grid">
        <article class="panel">
          <h3>Scenario Inputs</h3>
          <div class="calc-form">
            <div class="field">
              <label for="calcCountry">Origin Country</label>
              <select id="calcCountry"></select>
            </div>
            <div class="field">
              <label for="calcCommodity">Commodity Program</label>
              <select id="calcCommodity">
                <option value="none">General goods (no specific Section 232/301 program)</option>
                <option value="steel">Steel and derivative steel articles</option>
                <option value="aluminum">Aluminum and derivative aluminum articles</option>
                <option value="autos">Passenger automobiles (HTS 8703)</option>
                <option value="auto_parts">Automobile parts (covered part families)</option>
                <option value="mhdv">Medium/heavy-duty vehicles and listed parts</option>
                <option value="buses">Buses and HTS 8702 vehicles</option>
                <option value="copper">Semi-finished copper and listed derivatives</option>
                <option value="timber_softwood">Softwood timber/lumber</option>
                <option value="timber_derivative">Listed wood derivatives (cabinets, vanities, upholstered wood)</option>
                <option value="semiconductors">Semiconductors / SME / listed derivatives</option>
                <option value="critical_minerals">Processed critical minerals (monitor track)</option>
                <option value="china_301_strategic">China Section 301 strategic products</option>
                <option value="branded_pharma">Branded/patented pharmaceuticals (100%)</option>
                <option value="medical_devices">Medical devices / PPE / medical equipment</option>
              </select>
            </div>
            <div class="field">
              <label for="calcHts">HTS Code (Optional)</label>
              <input id="calcHts" placeholder="e.g., 8703.23.00" />
            </div>
            <div class="field">
              <label for="calcQuantity">Quantity (Optional)</label>
              <input id="calcQuantity" type="number" min="0" step="1" value="1" />
            </div>
            <div class="field">
              <label for="calcCustomsValue">Customs Value USD</label>
              <input id="calcCustomsValue" type="number" min="0" step="0.01" value="100000" />
            </div>
            <div class="field">
              <label for="calcFreightInsurance">Freight + Insurance USD</label>
              <input id="calcFreightInsurance" type="number" min="0" step="0.01" value="3500" />
            </div>
            <div class="field">
              <label for="calcMfnRate">MFN Rate %</label>
              <input id="calcMfnRate" type="number" min="0" step="0.01" value="0" />
            </div>
            <div class="field">
              <label for="calcSection301Rate">Section 301 Rate % (if applicable)</label>
              <input id="calcSection301Rate" type="number" min="0" step="0.01" value="25" />
            </div>
            <div class="check-grid">
              <label class="check"><input type="checkbox" id="calcIncludeContested" />Include IEEPA layers (struck down Feb 20 — for historical/refund analysis only)</label>
              <label class="check"><input type="checkbox" id="calcApplyNonStacking" checked />Apply non-stacking simplification (use highest special-duty bucket)</label>
              <label class="check"><input type="checkbox" id="calcUsmcaQualified" />Shipment qualifies under USMCA rules of origin</label>
              <label class="check"><input type="checkbox" id="calcEnergyPotash" />Goods are Canada/Mexico energy or potash bucket</label>
              <label class="check"><input type="checkbox" id="calcBrazilTargeted" />Goods are in Brazil-targeted Annex product list</label>
              <label class="check"><input type="checkbox" id="calcIncludeSection122" checked />Include Section 122 global surcharge (15%, effective Feb 24 2026 for ~150 days)</label>
              <label class="check"><input type="checkbox" id="calcSection122Exempt" />Goods are exempt from Section 122 (pharma, certain ag, critical minerals, some electronics)</label>
            </div>
          </div>
          <button class="button" id="runCalcButton">Calculate Landed Cost</button>
        </article>
        <article class="panel">
          <h3>Estimated Output</h3>
          <div class="calc-summary" id="calcSummary"></div>
          <div class="table-wrap">
            <table class="compact" id="calcBreakdownTable">
              <thead>
                <tr>
                  <th>Component</th>
                  <th>Nominal Rate</th>
                  <th>Applied Rate</th>
                  <th>Duty Amount</th>
                  <th>Note</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </article>
      </div>
      <p class="small-note" style="margin-top:10px;">Assumptions: this estimator is for planning only, not customs entry filing. Use broker/legal review for HTS line-level application, exclusions, AD/CVD, and liquidation risk.</p>
    </section>

    <section class="view" data-view="sources">
      <h2 class="section-title">Sourcebook (Reputable / Primary Sources)</h2>
      <p class="small-note">Only official government/legal sources are used here for core tariff status. Each source below is directly linked.</p>
      <div class="source-list">
        <ol id="sourceList"></ol>
      </div>
    </section>

    <section class="view" data-view="gaps">
      <h2 class="section-title">Gaps And Next Updates Required</h2>
      <p class="small-note">To become a true one-stop Bloomberg-style desk for global procurement, the platform still needs these data integrations and controls.</p>
      <div class="gaps">
        <article class="panel">
          <h3>Critical Data Gaps</h3>
          <ul id="gapList"></ul>
        </article>
        <article class="panel">
          <h3>Implementation Backlog</h3>
          <ul id="backlogList"></ul>
        </article>
      </div>
    </section>

    <footer class="site-disclaimer" role="contentinfo" aria-label="Legal disclaimer">
      <div class="disclaimer-header">
        <span class="disc-icon">⚠️</span>
        <strong>Internal Use Only &mdash; Not Legal, Customs, or Investment Advice</strong>
      </div>
      <div class="disclaimer-body">
        <p><strong>This tool is provided solely for internal procurement planning and informational purposes within Siemens Healthineers. It is not intended for external distribution, publication, or use by any third party.</strong></p>
        <p>The information presented in this dashboard does not constitute legal advice, customs classification advice, investment advice, or guidance on regulatory compliance. Tariff rates, legal statuses, and trade policy details change frequently and without notice. No representation or warranty, express or implied, is made as to the accuracy, completeness, or timeliness of any information shown.</p>
        <ul>
          <li><strong>Not a substitute for professional advice:</strong> Always confirm operative tariff treatment, HTS classification, and applicable duty rates with a licensed customs broker, trade counsel, or your Siemens Healthineers Legal/Trade Compliance team before executing any purchase order, shipment booking, or supplier contract.</li>
          <li><strong>No liability:</strong> The author(s) and Siemens Healthineers accept no liability for decisions made on the basis of this tool. Use of this information is entirely at the user's own risk. This tool does not constitute a binding determination of any customs, legal, or trade obligation.</li>
          <li><strong>Data currency:</strong> Feed data is drawn from publicly available official sources (U.S. Federal Register, CBP, European Commission, etc.) and is refreshed automatically but may lag real-time regulatory changes. Always verify with primary sources before acting.</li>
          <li><strong>Internal only:</strong> This dashboard contains market intelligence and procurement analysis compiled for internal business planning. Do not share externally, publish, or distribute outside authorised Siemens Healthineers channels without prior Legal review and approval.</li>
          <li><strong>No guarantee of completeness:</strong> This tool does not cover every applicable tariff, duty, tax, or trade restriction that may apply to a specific transaction. Anti-dumping, countervailing duties, sanctions, embargoes, export controls, and local import regulations are not fully modelled.</li>
        </ul>
        <p>For any questions regarding the legal or compliance status of a specific trade transaction, contact the Siemens Healthineers Trade Compliance or Legal function directly.</p>
      </div>
      <div class="disclaimer-stamp">
        <span>Last content update: Feb 24, 2026 &nbsp;&middot;&nbsp; Prepared for internal Siemens Healthineers Procurement use</span>
        <span class="stamp-tag">&#128274; Internal &amp; Confidential</span>
      </div>
    </footer>
  </div>

  <script>
    const META = {
      asOf: "2026-02-25",
      legalShockDate: "2026-02-20",
      section122EffectiveDate: "2026-02-24",
      section122ExpiryDate: "2026-07-24",
      scotusRulingDate: "2026-02-20"
    };

    const SOURCEBOOK = {
      scotus_case: {
        title: "U.S. Supreme Court slip opinion listing (24-1287, Learning Resources, Inc. v. Trump)",
        url: "https://www.supremecourt.gov/opinions/slipopinion/25",
        note: "Decided 2026-02-20"
      },
      scotus_pdf: {
        title: "U.S. Supreme Court opinion PDF (24-1287)",
        url: "https://www.supremecourt.gov/opinions/25pdf/24-1287_4gcj.pdf",
        note: "IEEPA tariff authority ruling"
      },
      fr_reciprocal_base: {
        title: "Federal Register: EO 14257 (Reciprocal Tariff Base Program)",
        url: "https://www.federalregister.gov/documents/2025/04/07/2025-06063/regulating-imports-with-a-reciprocal-tariff-to-rectify-trade-practices-that-contribute-to-large-and"
      },
      wh_reciprocal_july: {
        title: "White House: Further Modifying the Reciprocal Tariff Rates (July 31, 2025)",
        url: "https://www.whitehouse.gov/presidential-actions/2025/07/further-modifying-the-reciprocal-tariff-rates/"
      },
      fr_reciprocal_july: {
        title: "Federal Register: EO 14326 (country adjusted reciprocal rates)",
        url: "https://www.federalregister.gov/documents/2025/08/06/2025-15010/further-modifying-the-reciprocal-tariff-rates"
      },
      fr_scope_framework: {
        title: "Federal Register: EO 14346 (Reciprocal scope updates and framework procedures)",
        url: "https://www.federalregister.gov/documents/2025/09/10/2025-17507/modifying-the-scope-of-reciprocal-tariffs-and-establishing-procedures-for-implementing-trade-and"
      },
      wh_china_nov: {
        title: "White House: U.S.-PRC reciprocal tariff suspension extension (Nov 4, 2025)",
        url: "https://www.whitehouse.gov/presidential-actions/2025/11/modifying-reciprocal-tariff-rates-consistent-with-the-economic-and-trade-arrangement-between-the-united-states-and-the-peoples-republic-of-china/"
      },
      fr_china_nov: {
        title: "Federal Register: EO 14368 (PRC reciprocal tariff suspension to Nov 10, 2026)",
        url: "https://www.federalregister.gov/documents/2025/11/07/2025-19826/modifying-reciprocal-tariff-rates-consistent-with-the-economic-and-trade-arrangement-between-the"
      },
      fr_steel_2025: {
        title: "Federal Register: Proclamation 10896 (Steel)",
        url: "https://www.federalregister.gov/documents/2025/02/18/2025-02833/adjusting-imports-of-steel-into-the-united-states"
      },
      fr_aluminum_2025: {
        title: "Federal Register: Proclamation 10895 (Aluminum)",
        url: "https://www.federalregister.gov/documents/2025/02/18/2025-02832/adjusting-imports-of-aluminum-into-the-united-states"
      },
      fr_steel_al_50: {
        title: "Federal Register: Proclamation 10947 (Steel/Aluminum increase to 50%)",
        url: "https://www.federalregister.gov/documents/2025/06/09/2025-10524/adjusting-imports-of-aluminum-and-steel-into-the-united-states"
      },
      fr_autos: {
        title: "Federal Register: Proclamation 10908 (Autos and Parts)",
        url: "https://www.federalregister.gov/documents/2025/04/03/2025-05930/adjusting-imports-of-automobiles-and-automobile-parts-into-the-united-states"
      },
      fr_autos_amend: {
        title: "Federal Register: Proclamation 10925 (Auto offset amendments)",
        url: "https://www.federalregister.gov/documents/2025/05/02/2025-07833/amendments-to-adjusting-imports-of-automobiles-and-automobile-parts-into-the-united-states"
      },
      fr_mhdv: {
        title: "Federal Register: Proclamation 10984 (Medium/Heavy Vehicles, Parts, Buses)",
        url: "https://www.federalregister.gov/documents/2025/10/22/2025-19639/adjusting-imports-of-medium--and-heavy-duty-vehicles-medium--and-heavy-duty-vehicle-parts-and-buses"
      },
      fr_copper: {
        title: "Federal Register: Proclamation 10962 (Copper and derivatives)",
        url: "https://www.federalregister.gov/documents/2025/08/05/2025-14893/adjusting-imports-of-copper-into-the-united-states"
      },
      fr_timber: {
        title: "Federal Register: Proclamation 10976 (Timber/Lumber)",
        url: "https://www.federalregister.gov/documents/2025/10/06/2025-19482/adjusting-imports-of-timber-lumber-and-their-derivative-products-into-the-united-states"
      },
      fr_timber_amend: {
        title: "Federal Register: Proclamation 11000 (Timber/Lumber amendments)",
        url: "https://www.federalregister.gov/documents/2026/01/09/2026-00327/amendments-to-adjusting-imports-of-timber-lumber-and-their-derivative-products-into-the-united"
      },
      fr_semis: {
        title: "Federal Register: Proclamation 11002 (Semiconductors and SME)",
        url: "https://www.federalregister.gov/documents/2026/01/20/2026-01052/adjusting-imports-of-semiconductors-semiconductor-manufacturing-equipment-and-their-derivative"
      },
      fr_critical_minerals: {
        title: "Federal Register: Proclamation 11001 (Processed critical minerals)",
        url: "https://www.federalregister.gov/documents/2026/01/20/2026-01045/adjusting-imports-of-processed-critical-minerals-and-their-derivative-products-into-the-united"
      },
      fr_de_minimis: {
        title: "Federal Register: EO 14324 (Global de minimis suspension)",
        url: "https://www.federalregister.gov/documents/2025/08/05/2025-14897/suspending-duty-free-de-minimis-treatment-for-all-countries"
      },
      fr_canada_ieepa: {
        title: "Federal Register: EO 14193 + amendments (Canada northern border duties)",
        url: "https://www.federalregister.gov/documents/2025/02/07/2025-02406/imposing-duties-to-address-the-flow-of-illicit-drugs-across-our-northern-border"
      },
      fr_canada_35: {
        title: "Federal Register: EO 14328 (Canada duties to 35%)",
        url: "https://www.federalregister.gov/documents/2025/08/06/2025-14999/amendment-to-duties-to-address-the-flow-of-illicit-drugs-across-our-northern-border"
      },
      fr_mexico_ieepa: {
        title: "Federal Register: EO 14194 (Mexico southern border duties)",
        url: "https://www.federalregister.gov/documents/2025/02/07/2025-02407/imposing-duties-to-address-the-situation-at-our-southern-border"
      },
      fr_canada_usmca: {
        title: "Federal Register: EO 14231 (Canada USMCA carve-out; potash 10%)",
        url: "https://www.federalregister.gov/documents/2025/03/11/2025-03990/amendment-to-duties-to-address-the-flow-of-illicit-drugs-across-our-northern-border"
      },
      fr_mexico_usmca: {
        title: "Federal Register: EO 14232 (Mexico USMCA carve-out; potash 10%)",
        url: "https://www.federalregister.gov/documents/2025/03/11/2025-03991/amendment-to-duties-to-address-the-flow-of-illicit-drugs-across-our-southern-border"
      },
      fr_china_opioid: {
        title: "Federal Register: EO 14195 + EO 14369 (PRC opioid-linked duty to 10%)",
        url: "https://www.federalregister.gov/documents/2025/11/07/2025-19825/modifying-duties-addressing-the-synthetic-opioid-supply-chain-in-the-peoples-republic-of-china"
      },
      fr_uk_deal: {
        title: "Federal Register: EO 14305 (U.S.-UK Economic Prosperity Deal terms)",
        url: "https://www.federalregister.gov/documents/2025/06/23/2025-11473/implementing-the-general-terms-of-the-united-states-of-america-united-kingdom-economic-prosperity"
      },
      fr_japan_deal: {
        title: "Federal Register: EO 14345 (U.S.-Japan Agreement)",
        url: "https://www.federalregister.gov/documents/2025/09/09/2025-17389/implementing-the-united-states-japan-agreement"
      },
      fr_russia_oil: {
        title: "Federal Register: EO 14329 (Russia-linked secondary duty framework)",
        url: "https://www.federalregister.gov/documents/2025/08/11/2025-15267/addressing-threats-to-the-united-states-by-the-government-of-the-russian-federation"
      },
      fr_russia_india_relief: {
        title: "Federal Register: EO 14377 (India no longer subject to 25% Russia-oil duty)",
        url: "https://www.federalregister.gov/documents/2026/02/11/2026-02818/modifying-duties-to-address-threats-to-the-united-states-by-the-government-of-the-russian-federation"
      },
      fr_brazil_40: {
        title: "Federal Register: EO 14323 (40% duty on certain products of Brazil)",
        url: "https://www.federalregister.gov/documents/2025/08/05/2025-14896/addressing-threats-to-the-united-states-by-the-government-of-brazil"
      },
      fr_cuba_secondary: {
        title: "Federal Register: EO 14370 (Cuba-linked secondary tariff mechanism)",
        url: "https://www.federalregister.gov/documents/2026/02/03/2026-02250/addressing-threats-to-the-united-states-by-the-government-of-cuba"
      },
      fr_iran_secondary: {
        title: "Federal Register: EO 14376 (Iran-linked secondary tariff mechanism)",
        url: "https://www.federalregister.gov/documents/2026/02/11/2026-02813/addressing-threats-to-the-united-states-by-the-government-of-iran"
      },
      fr_non_stacking: {
        title: "Federal Register: EO 14289 (Non-stacking rules among key tariff programs)",
        url: "https://www.federalregister.gov/documents/2025/05/02/2025-07835/addressing-certain-tariffs-on-imported-articles"
      },
      canada_response: {
        title: "Government of Canada: Canada's response to U.S. tariffs",
        url: "https://www.canada.ca/en/department-finance/programs/international-trade-finance-policy/canadas-response-us-tariffs.html",
        note: "Page modified 2026-01-15"
      },
      ustr_301_2024: {
        title: "USTR: Finalized Section 301 tariff increases (strategic products from China)",
        url: "https://ustr.gov/about-us/policy-offices/press-office/press-releases/2024/may/ustr-finalizes-tariff-increases-chinese-products-electric-vehicles-batteries-solar-cells-critical-minerals-medicals-and"
      },
      wh_section122_factsheet: {
        title: "White House: Fact Sheet — Temporary Import Duty Under Section 122 (Feb 20, 2026)",
        url: "https://www.whitehouse.gov/fact-sheets/2026/02/fact-sheet-president-donald-j-trump-imposes-a-temporary-import-duty-to-address-fundamental-international-payment-problems/",
        note: "Section 122 Trade Act of 1974; temporary 10% global import duty; effective Feb 24 2026"
      },
      wh_section122_proclamation: {
        title: "White House: Adjusting Imports To Address Fundamental International Payment Problems (Section 122 Proclamation)",
        url: "https://www.whitehouse.gov/presidential-actions/2026/02/adjusting-imports-to-address-fundamental-international-payment-problems/",
        note: "Operative 10% ad valorem temporary import duty effective Feb 24, 2026; annexes define exceptions"
      },
      axios_section122: {
        title: "Axios: How Section 122 and the 10%→15% shift works (Feb 20, 2026)",
        url: "https://www.axios.com/2026/02/20/trump-tariff-plan-section-122-trade-act",
        note: "Covers Section 122 mechanics and reported escalation discussions; use White House proclamation for operative rate"
      },
      scotusblog_ieepa: {
        title: "SCOTUSblog: Breakdown of the IEEPA tariff decision (Feb 20, 2026)",
        url: "https://www.scotusblog.com/2026/02/a-breakdown-of-the-courts-tariff-decision/",
        note: "Analysis of 6-3 ruling and which tariffs remain"
      },
      fr_pharma_232_invest: {
        title: "BIS/Commerce: Section 232 investigation into pharmaceuticals (initiated Apr 1, 2025)",
        url: "https://www.federalregister.gov/documents/2025/04/01",
        note: "Covers finished drugs, biologics, APIs, key starting materials"
      },
      fr_meddevice_232_invest: {
        title: "BIS/Commerce: Section 232 investigation into medical devices/PPE (initiated Sep 24, 2025)",
        url: "https://www.supplychaindive.com/news/trump-tariffs-medical-devices-equipment-ppe-section-232-investigation/761070/",
        note: "Covers CT, MRI, X-ray, pacemakers, stents, ventilators, PPE; report due May 30 2026"
      },
      aha_pharma_tariff: {
        title: "AHA: Trump announces 100% tariff on branded/patented pharmaceuticals (effective Oct 1, 2025)",
        url: "https://www.aha.org/news/headline/2025-09-26-president-announces-new-tariffs-including-certain-pharmaceuticals-set-begin-oct-1",
        note: "100% unless manufacturer has US plant where construction has started (ground broken)"
      },
      wh_eu_deal: {
        title: "White House Fact Sheet: U.S.-EU Reach Massive Trade Deal (July 2025)",
        url: "https://www.whitehouse.gov/fact-sheets/2025/07/fact-sheet-the-united-states-and-european-union-reach-massive-trade-deal/",
        note: "EU pharma tariff ceiling 15%; EU generics at MFN (~0%); pharma provisions effective Sep 1, 2025"
      },
      manatt_eu_pharma: {
        title: "Manatt: US-EU Trade Agreement Pharma Tariff Analysis",
        url: "https://www.manatt.com/insights/insight/trump-administration-announces-u-s-eu-trade-agreement-including-new-tariff-levels-for-pharmaceuticals-and-carveout-for-generics",
        note: "15% ceiling confirmed; generics and their ingredients/precursors at MFN rates"
      },
      fr_uk_pharma: {
        title: "U.S.-UK Economic Deal: 0% pharma tariff for UK in exchange for US manufacturing investment",
        url: "https://www.federalregister.gov/documents/2025/06/23/2025-11473/implementing-the-general-terms-of-the-united-states-of-america-united-kingdom-economic-prosperity",
        note: "UK pharma/medtech 0% under deal terms; see EO 14305"
      },
      budgetlab_scotus: {
        title: "Yale Budget Lab: State of U.S. Tariffs After SCOTUS Ruling (Feb 20, 2026)",
        url: "https://budgetlab.yale.edu/research/state-us-tariffs-scotus-ruling-update",
        note: "Pre-SCOTUS effective rate 16%; post-SCOTUS 9.1%; Yale published 13.7% with Section 122 (Feb 21, 2026) before later operative-rate clarification. CBP collected ~$129B IEEPA duties through Dec 2025 — refund liability analysis"
      },
      taxfdn_trump_tariffs: {
        title: "Tax Foundation: Trump Tariff Economic Impact Tracker (updated Feb 2026)",
        url: "https://taxfoundation.org/research/all/federal/trump-tariffs-trade-war/",
        note: "Tax Foundation cites Yale's Feb 21, 2026 published estimate (13.7% with Section 122); pre-SCOTUS 16% (highest since 1936); $287B 2025 tariff revenue"
      },
      reuters_cbp_ieepa_halt: {
        title: "Reuters: U.S. customs agency to stop collecting IEEPA tariffs (Feb 23, 2026)",
        url: "https://www.investing.com/news/world-news/us-customs-agency-to-stop-collecting-tariffs-deemed-illegal-by-supreme-court-on-tuesday-4517734",
        note: "CBP to deactivate IEEPA tariff codes effective Feb 24, 2026; refund guidance still pending"
      },
      cnbc_scotus_industries: {
        title: "CNBC: Which industries still face higher tariff rates after SCOTUS ruling (Feb 20, 2026)",
        url: "https://www.cnbc.com/2026/02/20/trump-tariffs-supreme-court-ruling-industry-higher-rates.html",
        note: "Section 232 programs unaffected; de minimis also remains"
      },
      fr_india_interim: {
        title: "White House: U.S.-India Interim Agreement — Reciprocal tariff reduction to 18% on certain goods",
        url: "https://www.federalregister.gov/documents/2026/02",
        note: "IEEPA component now moot post-SCOTUS; bilateral deal pathway may survive"
      }
    };

    const EU_MEMBERS = [
      "Austria", "Belgium", "Bulgaria", "Croatia", "Cyprus", "Czechia", "Denmark", "Estonia", "Finland", "France", "Germany",
      "Greece", "Hungary", "Ireland", "Italy", "Latvia", "Lithuania", "Luxembourg", "Malta", "Netherlands", "Poland",
      "Portugal", "Romania", "Slovakia", "Slovenia", "Spain", "Sweden"
    ];

    const COUNTRY_ALIASES = {
      "Ivory Coast": "Côte d'Ivoire",
      "DR Congo": "Democratic Republic of the Congo",
      "Democratic Republic of Congo": "Democratic Republic of the Congo",
      "Myanmar": "Myanmar (Burma)",
      "Republic of Türkiye": "Turkey",
      "Korea, South": "South Korea",
      "Korea, North": "North Korea",
      "UK": "United Kingdom",
      "U.K.": "United Kingdom",
      "US": "United States",
      "U.S.": "United States",
      "European Union": "EU"
    };

    const ANNEX_RATES = {
      "Afghanistan": "15%",
      "Algeria": "30%",
      "Angola": "15%",
      "Bangladesh": "20%",
      "Bolivia": "15%",
      "Bosnia and Herzegovina": "30%",
      "Botswana": "15%",
      "Brazil": "10%",
      "Brunei": "25%",
      "Cambodia": "19%",
      "Cameroon": "15%",
      "Chad": "15%",
      "Costa Rica": "15%",
      "Côte d'Ivoire": "15%",
      "Democratic Republic of the Congo": "15%",
      "Ecuador": "15%",
      "Equatorial Guinea": "15%",
      "Falkland Islands": "10%",
      "Fiji": "15%",
      "Ghana": "15%",
      "Guyana": "15%",
      "Iceland": "15%",
      "India": "25%",
      "Indonesia": "19%",
      "Iraq": "35%",
      "Israel": "15%",
      "Japan": "15%",
      "Jordan": "15%",
      "Kazakhstan": "25%",
      "Laos": "40%",
      "Lesotho": "15%",
      "Libya": "30%",
      "Liechtenstein": "15%",
      "Madagascar": "15%",
      "Malawi": "15%",
      "Malaysia": "19%",
      "Mauritius": "15%",
      "Moldova": "25%",
      "Mozambique": "15%",
      "Myanmar (Burma)": "40%",
      "Namibia": "15%",
      "Nauru": "15%",
      "New Zealand": "15%",
      "Nicaragua": "18%",
      "Nigeria": "15%",
      "North Macedonia": "15%",
      "Norway": "15%",
      "Pakistan": "19%",
      "Papua New Guinea": "15%",
      "Philippines": "19%",
      "Serbia": "35%",
      "South Africa": "30%",
      "South Korea": "15%",
      "Sri Lanka": "20%",
      "Switzerland": "39%",
      "Syria": "41%",
      "Taiwan": "20%",
      "Thailand": "19%",
      "Trinidad and Tobago": "15%",
      "Tunisia": "25%",
      "Turkey": "15%",
      "Uganda": "15%",
      "United Kingdom": "10%",
      "Vanuatu": "15%",
      "Venezuela": "15%",
      "Vietnam": "20%",
      "Zambia": "15%",
      "Zimbabwe": "15%"
    };

    const FALLBACK_COUNTRIES = Array.from(new Set([
      ...Object.keys(ANNEX_RATES),
      ...EU_MEMBERS,
      "Canada", "Mexico", "China", "Brazil", "Russia", "India", "Japan", "United Kingdom", "South Korea", "Taiwan", "Switzerland", "Singapore", "Turkey", "Thailand", "Vietnam", "Indonesia", "Malaysia", "Philippines", "United States", "EU"
    ])).sort((a, b) => a.localeCompare(b));

    const COMMODITY_ROWS = [
      {
        commodity: "Steel & derivative steel articles",
        treatment: "Additional 50% ad valorem under Section 232 (UK currently 25% carve-out pending arrangement controls)",
        coverage: "Steel mill products plus derivative steel articles; melt-and-pour and transshipment enforcement tightened.",
        status: "Active",
        sourceIds: ["fr_steel_2025", "fr_steel_al_50", "fr_uk_deal"]
      },
      {
        commodity: "Aluminum & derivative aluminum articles",
        treatment: "Additional 50% ad valorem under Section 232 (UK currently 25% carve-out pending arrangement controls)",
        coverage: "Primary aluminum and derivatives; Russian-origin smelt/cast treatment separately tightened in existing framework.",
        status: "Active",
        sourceIds: ["fr_aluminum_2025", "fr_steel_al_50", "fr_uk_deal"]
      },
      {
        commodity: "Passenger automobiles (HTS 8703)",
        treatment: "25% Section 232 base; UK TRQ 100,000 vehicles at combined 10%; Japan autos adjusted to 15% total floor",
        coverage: "Sedans, SUVs, crossover vehicles, minivans, cargo vans and light trucks.",
        status: "Active",
        sourceIds: ["fr_autos", "fr_autos_amend", "fr_uk_deal", "fr_japan_deal"]
      },
      {
        commodity: "Automobile parts",
        treatment: "25% Section 232 on covered parts; manufacturer offset programs (3.75% and 2.5%) remain in force",
        coverage: "Engines and engine parts, transmissions and powertrain parts, electrical components, and additions via FR notices.",
        status: "Active",
        sourceIds: ["fr_autos", "fr_autos_amend", "fr_japan_deal"]
      },
      {
        commodity: "Medium/heavy-duty vehicles, parts, buses",
        treatment: "25% for MHDVs and listed parts; 10% for buses and HTS 8702 vehicles",
        coverage: "Class 4-8 truck platforms, medium/heavy vehicle parts, buses; includes offset process for qualifying U.S. assembly.",
        status: "Active",
        sourceIds: ["fr_mhdv"]
      },
      {
        commodity: "Timber, lumber, wood derivatives",
        treatment: "10% on softwood timber/lumber; 25% on listed upholstered wood products and kitchen cabinets/vanities",
        coverage: "Rates effective 2025-10-14. Planned escalation to 30%/50% was deferred to 2027-01-01.",
        status: "Active",
        sourceIds: ["fr_timber", "fr_timber_amend"]
      },
      {
        commodity: "Semi-finished copper + intensive copper derivatives",
        treatment: "50% tariff from 2025-08-01",
        coverage: "Annex-defined semi-finished and intensive derivative products; policy track includes potential refined copper phases in 2027/2028.",
        status: "Active",
        sourceIds: ["fr_copper"]
      },
      {
        commodity: "Certain advanced semiconductors, semiconductor manufacturing equipment, derivatives",
        treatment: "25% ad valorem on covered products from 2026-01-15",
        coverage: "NARROW SCOPE: Targets only advanced computing chips meeting specific technical thresholds (high-bandwidth logic ICs — e.g., NVIDIA H200-class). Standard industrial chips and most medical imaging electronics are NOT in scope. Exceptions for U.S. data center builds, R&D, and startups. Proclamation includes domestic-capacity exception pathways.",
        status: "Active",
        sourceIds: ["fr_semis"]
      },
      {
        commodity: "Processed critical minerals and derivatives",
        treatment: "No immediate across-the-board tariff in Proclamation 11001",
        coverage: "Negotiation-and-monitoring framework under Section 232; further action can be imposed after negotiation status review.",
        status: "Watch",
        sourceIds: ["fr_critical_minerals"]
      },
      {
        commodity: "Cross-border low-value parcels (de minimis)",
        treatment: "Global suspension of duty-free de minimis for covered shipments; postal duty methods by effective IEEPA rate buckets",
        coverage: "Applies regardless of country for covered goods; postal specific duties include $80/$160/$200 tiers before full ad valorem transition.",
        status: "Active",
        sourceIds: ["fr_de_minimis"]
      },
      {
        commodity: "China strategic products under Section 301",
        treatment: "Section 301 increases remain in force for targeted strategic sectors (rates vary by product, including very high duty tiers)",
        coverage: "EVs, batteries, solar cells, critical minerals, semiconductors, cranes, and selected medical products (product-specific implementation schedule).",
        status: "Active",
        sourceIds: ["ustr_301_2024"]
      },
      {
        commodity: "Section 122 Global Import Surcharge — ALL COUNTRIES",
        treatment: "10% ad valorem on covered imports from all countries effective Feb 24, 2026 under the White House Section 122 proclamation. Section 122 statute allows up to 15% for up to 150 days.",
        coverage: "Broad temporary surcharge with proclamation exceptions including pharmaceuticals/pharmaceutical ingredients, certain agriculture, critical minerals/metals, some electronics, passenger vehicles and many other vehicle categories/parts, Section 232-covered goods (no stacking), USMCA-qualifying Canada/Mexico goods, and selected other listed categories. 150-day duration (~Jul 24, 2026) unless Congress approves extension.",
        status: "Active",
        sourceIds: ["wh_section122_proclamation", "wh_section122_factsheet", "axios_section122", "cnbc_scotus_industries"]
      },
      {
        commodity: "Branded/Patented Pharmaceuticals",
        treatment: "100% tariff on branded/patented drug products. Exception: manufacturer has U.S. manufacturing plant where construction has started (ground broken or actively under construction). Investment pledges or commitments alone are NOT sufficient. Note: EU-origin branded pharma is capped at 15% under the U.S.-EU Framework Agreement (Aug 2025).",
        coverage: "Branded prescription drugs, patented formulations, biologics. UK-sourced pharma/medtech: 0% under US-UK Economic Prosperity Deal. Several large pharma companies secured 3-year exemptions via voluntary investment pledges (Merck, BMS, Novartis, others).",
        status: "Active",
        sourceIds: ["aha_pharma_tariff", "fr_uk_pharma"]
      },
      {
        commodity: "Medical Devices, PPE & Medical Equipment",
        treatment: "No dedicated tariff yet; Section 232 investigation active. Section 122 10% surcharge may apply from Feb 24 to non-exempt imports, while Section 232-covered goods remain exempt from §122 stacking under the proclamation.",
        coverage: "CT scanners, MRI machines, X-ray/angiography, electrosurgical equipment, pacemakers, insulin pumps, coronary stents, heart valves, ventilators, respirators, oxygen equipment, PPE (gloves, gowns, masks), orthopedic appliances, hearing aids.",
        status: "Watch",
        sourceIds: ["fr_meddevice_232_invest", "wh_section122_factsheet"]
      },
      {
        commodity: "Generic Pharmaceuticals / APIs / Key Starting Materials",
        treatment: "Section 232 investigation active; no standalone tariff imposed yet. White House Section 122 proclamation/fact sheet exempt pharmaceuticals and pharmaceutical ingredients, so generic drugs/APIs appear exempt from §122 pending CBP implementation detail.",
        coverage: "Active pharmaceutical ingredients, key starting materials, finished generic drugs, medical countermeasures. Predominantly China and India supply chains.",
        status: "Watch",
        sourceIds: ["fr_pharma_232_invest", "wh_section122_factsheet"]
      }
    ];

    const CALC_COMMODITY_RULES = {
      none: {
        label: "General goods",
        affected: "No dedicated Section 232/301 commodity program selected."
      },
      steel: {
        label: "Steel and derivative steel articles",
        section232Rate: 50,
        section232RateUk: 25,
        affected: "Steel mill products and derivative steel articles in Section 232 scope."
      },
      aluminum: {
        label: "Aluminum and derivative aluminum articles",
        section232Rate: 50,
        section232RateUk: 25,
        affected: "Primary aluminum and derivative aluminum products in Section 232 scope."
      },
      autos: {
        label: "Passenger automobiles (HTS 8703)",
        section232Rate: 25,
        section232RateUk: 10,
        section232RateJapan: 15,
        affected: "Passenger vehicles and light trucks under auto proclamations and related deal pathways."
      },
      auto_parts: {
        label: "Automobile parts",
        section232Rate: 25,
        section232RateUk: 10,
        section232RateJapan: 15,
        affected: "Covered engines, powertrain, electrical, and listed auto part families."
      },
      mhdv: {
        label: "Medium/heavy-duty vehicles and listed parts",
        section232Rate: 25,
        affected: "MHDV platforms and listed parts under Proclamation 10984."
      },
      buses: {
        label: "Buses and HTS 8702 vehicles",
        section232Rate: 10,
        affected: "Buses and listed 8702 vehicles under Proclamation 10984."
      },
      copper: {
        label: "Semi-finished copper and listed derivatives",
        section232Rate: 50,
        affected: "Annex-listed semi-finished copper and intensive derivative products."
      },
      timber_softwood: {
        label: "Softwood timber/lumber",
        section232Rate: 10,
        affected: "Softwood timber/lumber products covered in timber program."
      },
      timber_derivative: {
        label: "Listed wood derivatives",
        section232Rate: 25,
        affected: "Listed upholstered wood products plus kitchen cabinets/vanities."
      },
      semiconductors: {
        label: "Semiconductors / SME / listed derivatives",
        section232Rate: 25,
        affected: "Covered semiconductors, semiconductor manufacturing equipment, and derivatives."
      },
      critical_minerals: {
        label: "Processed critical minerals (watch track)",
        section232Rate: 0,
        affected: "Negotiation-and-monitoring pathway; no broad tariff in proclamation baseline."
      },
      china_301_strategic: {
        label: "China Section 301 strategic products",
        section301Default: 25,
        affected: "Strategic sectors including EVs, batteries, solar, semiconductors, cranes, selected medical products."
      },
      branded_pharma: {
        label: "Branded/patented pharmaceuticals",
        brandedPharmaRate: 100,
        affected: "Branded prescription drugs, patented formulations, biologics. Exception for companies with US plant under construction."
      },
      medical_devices: {
        label: "Medical devices and PPE",
        section232Rate: 0,
        affected: "CT, MRI, X-ray, pacemakers, stents, ventilators, PPE. No dedicated S.232 tariff yet; S.122 (10%) may apply to non-exempt device imports. S.232 metal/semi rates apply to component-level imports."
      }
    };

    const CALC_PRIORITY = ["branded_pharma", "section232", "section301", "section122", "ieepa"];

    const TIMELINE = [
      {
        date: "2025-02-01",
        event: "IEEPA border and opioid-linked tariff orders initiated (Canada, Mexico, PRC tracks).",
        meta: "EO 14193, EO 14194, EO 14195",
        sourceIds: ["fr_canada_ieepa", "fr_mexico_ieepa", "fr_china_opioid"]
      },
      {
        date: "2025-03-07",
        event: "USMCA-related carve-outs and potash treatment changes for Canada and Mexico amendments.",
        meta: "Potash moved to 10% for non-USMCA bucket in amendments",
        sourceIds: ["fr_canada_usmca", "fr_mexico_usmca"]
      },
      {
        date: "2025-04-03",
        event: "Section 232 auto tariff architecture takes effect for automobiles; parts follow with staged implementation.",
        meta: "25% base with U.S.-content logic for eligible USMCA handling",
        sourceIds: ["fr_autos", "fr_autos_amend"]
      },
      {
        date: "2025-04-07",
        event: "Reciprocal IEEPA baseline program published (EO 14257).",
        meta: "Country and product scope modified multiple times in 2025",
        sourceIds: ["fr_reciprocal_base"]
      },
      {
        date: "2025-06-04",
        event: "Section 232 steel and aluminum rates raised to 50% (with UK temporary carve-out at 25%).",
        meta: "Rates active from June 4, 2025",
        sourceIds: ["fr_steel_al_50"]
      },
      {
        date: "2025-07-31",
        event: "Revised reciprocal country table published; baseline remains 10% for non-listed partners; EU formula introduced.",
        meta: "Annex I country schedule",
        sourceIds: ["wh_reciprocal_july", "fr_reciprocal_july"]
      },
      {
        date: "2025-08-01",
        event: "Copper proclamation applies 50% on listed semi-finished and intensive derivative imports.",
        meta: "Section 232 copper expansion",
        sourceIds: ["fr_copper"]
      },
      {
        date: "2025-08-21",
        event: "U.S.-EU Framework Agreement formally published (political agreement July 27, 2025). Caps EU pharmaceutical and medtech tariffs at a maximum 15% ceiling — the 100% branded-drug rate does NOT apply to EU-origin products. EU generic pharmaceuticals and their ingredients/chemical precursors receive MFN rates (effectively 0%). Pharmaceutical provisions effective September 1, 2025. Covers ~€120B in annual EU pharmaceutical exports. CRITICAL FOR SHS: SHS pharmaceutical and medtech products shipped from Germany/EU face 15% maximum tariff, not 100%.",
        meta: "US-EU Economic Prosperity Framework; pharma ceiling = 15%; EU generics = ~0% MFN; ~€120B in EU pharma exports affected",
        sourceIds: ["wh_eu_deal", "manatt_eu_pharma"]
      },
      {
        date: "2025-08-29",
        event: "Global de minimis suspension order becomes effective for covered flows.",
        meta: "Postal fee methods and transition rules included",
        sourceIds: ["fr_de_minimis"]
      },
      {
        date: "2025-09-09",
        event: "U.S.-Japan agreement order published, including 15% total-tariff logic for selected pathways.",
        meta: "Includes auto and reciprocal handling mechanics",
        sourceIds: ["fr_japan_deal"]
      },
      {
        date: "2025-10-14",
        event: "Timber/lumber and listed wood derivatives tariff program takes effect.",
        meta: "Escalation deferred by Jan 2026 amendment",
        sourceIds: ["fr_timber", "fr_timber_amend"]
      },
      {
        date: "2025-11-01",
        event: "Medium/heavy-duty vehicle and bus tariffs start.",
        meta: "25% MHDV + parts, 10% buses",
        sourceIds: ["fr_mhdv"]
      },
      {
        date: "2025-11-10",
        event: "PRC opioid-linked duty reduced to 10%; heightened reciprocal PRC tariffs remain suspended through Nov 10, 2026.",
        meta: "Under U.S.-PRC arrangement terms",
        sourceIds: ["fr_china_opioid", "fr_china_nov", "wh_china_nov"]
      },
      {
        date: "2026-01-15",
        event: "Semiconductor, SME, and derivative covered products tariff framework enters force (25% on covered products).",
        meta: "Includes end-use and domestic-capacity conditions",
        sourceIds: ["fr_semis"]
      },
      {
        date: "2026-02-07",
        event: "India removed from Russia-linked 25% secondary duty treatment.",
        meta: "Modification under EO 14377",
        sourceIds: ["fr_russia_india_relief"]
      },
      {
        date: "2025-04-01",
        event: "Department of Commerce initiates Section 232 investigation into pharmaceuticals — finished drugs, generics, APIs, biologics, medical countermeasures all in scope.",
        meta: "Potential tariffs or quotas after report completion",
        sourceIds: ["fr_pharma_232_invest"]
      },
      {
        date: "2025-09-24",
        event: "Commerce/BIS opens Section 232 investigation into medical devices, PPE, and medical consumables. Explicitly covers CT, MRI, X-ray, pacemakers, insulin pumps, stents, ventilators, respirators, hearing aids — directly impacting Siemens Healthineers product portfolio.",
        meta: "Report due May 30, 2026; President has 90 days after report to act",
        sourceIds: ["fr_meddevice_232_invest"]
      },
      {
        date: "2025-10-01",
        event: "100% tariff on branded/patented pharmaceutical products takes effect. Exemption requires U.S. manufacturing plant where construction has started (ground broken or under construction) — investment pledges alone are insufficient. Note: EU-origin branded pharma capped at 15% under U.S.-EU Framework Agreement.",
        meta: "Branded drugs, patented products; EU-origin capped at 15% (US-EU Framework); generics covered separately under pharma S.232 investigation",
        sourceIds: ["aha_pharma_tariff"]
      },
      {
        date: "2026-02-07",
        event: "India removed from Russia-linked 25% secondary duty treatment. U.S.-India Interim Agreement reduces IEEPA reciprocal rates on certain Indian goods to 18%.",
        meta: "Modification under EO 14377; IEEPA component now legally contested post-Feb 20 ruling",
        sourceIds: ["fr_russia_india_relief", "fr_india_interim"]
      },
      {
        date: "2026-02-20",
        event: "LANDMARK: Supreme Court rules 6-3 (24-1287, Learning Resources, Inc. v. Trump) that IEEPA does not authorize the President to impose tariffs. All IEEPA-derived tariff programs are struck down — including Liberation Day reciprocal tariffs, Canada/Mexico border duties, China opioid tariffs, and Brazil-targeted duties. Section 232 and Section 301 tariffs are NOT affected.",
        meta: "Chief Justice Roberts delivered majority opinion; CBP collected ~$129B in IEEPA duties across 34M entries (301,000+ importers) through Dec 2025; refund process via Post Summary Corrections and CIT §1581(i) suits — CBP/USTR guidance pending",
        sourceIds: ["scotus_case", "scotus_pdf", "scotusblog_ieepa", "budgetlab_scotus"]
      },
      {
        date: "2026-02-20",
        event: "Hours after SCOTUS ruling: Trump signs Proclamation invoking Section 122 of the Trade Act of 1974 — imposing a 10% global import surcharge on ALL countries. Effective Feb 24, 2026. Exceptions: pharmaceuticals (incl. diagnostic reagents), some agricultural products (beef, tomatoes, oranges), critical minerals/metals, some electronics, passenger vehicles, USMCA-qualifying goods from Canada and Mexico, and all Section 232-covered goods (steel, aluminum, autos, auto parts, MHDV/buses, copper, lumber, semiconductors — NO stacking with Section 232).",
        meta: "Never previously used; Section 122 allows maximum 15% for 150 days; no investigation required. LEGAL STATUS CONTESTED: trade experts argue S.122 is invalid because the U.S. does not have a qualifying balance-of-payments deficit under the statute (Fortune, Cato Institute, BCA Research). New legal challenges expected.",
        sourceIds: ["wh_section122_proclamation", "wh_section122_factsheet", "axios_section122"]
      },
      {
        date: "2026-02-21",
        event: "Reported follow-on escalation to a 15% Section 122 global surcharge (effective Feb 24, 2026) appears in media coverage of White House/Truth Social messaging, but no follow-on White House proclamation/Federal Register publication was located by this dashboard as of Feb 25, 2026; treat operative rate as 10% under the Feb 20 proclamation. (superseded)",
        meta: "Section 122 statutory max = 15%; reported escalation claim not corroborated by later operative legal text as of 2026-02-25",
        sourceIds: ["wh_section122_proclamation", "axios_section122", "cnbc_scotus_industries"]
      },
      {
        date: "2026-02-24",
        event: "CBP halts collection of IEEPA-based tariffs and deactivates related tariff codes following the Supreme Court ruling.",
        meta: "Collection stop effective 12:01 a.m. ET Feb 24; refund guidance still pending",
        sourceIds: ["reuters_cbp_ieepa_halt"]
      }
    ];

    const GAPS = [
      "CRITICAL: CBP implementation guidance for Section 122 (operative 10% surcharge under White House proclamation, effective Feb 24 2026) not yet published — confirm entry-line coding and exception handling before PO release.",
      "CRITICAL: IEEPA tariff unwinding CBP guidance pending — no official CBP/USTR instructions yet on refund processing for pre-Feb 20 shipments. Collections halted Feb 24, 2026 (Reuters).",
      "Medical Devices Section 232 investigation result unknown — Commerce report due May 30, 2026; impact on CT/MRI/X-ray imports could add +10–25% to import costs.",
      "Generic pharma Section 232 investigation ongoing — potential tariff on APIs and key starting materials from China and India remains a major SHS diagnostics supply chain risk.",
      "Official retaliation schedules incomplete for LATAM, ASEAN, MENA, and Africa customs authorities.",
      "Annex-level HTS code ingestion not yet machine-linked to every proclamation and exclusion table.",
      "AD/CVD, quota fill, and exclusion-approval overlays not yet integrated into landed-cost output.",
      "No direct CBP/ABI API integration for entry-level real-time tariff rate validation before PO release.",
      "No procurement-user role segmentation (buyer execution / legal-compliance / executive watch).",
      "Siemens Healthineers SKU-level supplier-country mapping not yet built — required for precision landed-cost estimates.",
      "Section 122 proclamation exceptions (including some electronics) are not yet mapped into this dashboard at annex/HTS-line level — scope remains unclear for SHS imaging electronics components.",
      "India-U.S. Interim Agreement full product list and IEEPA legal survival post-SCOTUS not yet confirmed."
    ];

    const BACKLOG = [
      "URGENT: Add Section 122 CBP implementation notices to Live Feeds as they are published (monitor CBP CSMS daily from Feb 22 onwards).",
      "URGENT: Build Section 122 expiry countdown timer visible on dashboard header (150 days from Feb 24 = Jul 24, 2026).",
      "Add Medical Devices Section 232 investigation status tracker with key dates (comment deadline, report due May 30, action deadline Aug 2026).",
      "Expand country retaliation feeds: Mexico (SAT), India (CBIC), South Korea (KCS), EU (DG TAXUD), Japan (MOF).",
      "Add HTS annex parser mapping covered codes directly to calculator presets and country cards.",
      "Add alert engine for high-impact Federal Register and CBP CSMS deltas with daily email digest to SHS procurement team.",
      "Build scenario compare mode (baseline vs Section 122 only vs Section 232 full stack vs negotiated carve-out) for sourcing decisions.",
      "Implement PDF/CSV export for procurement governance and category-lead briefings.",
      "Add SHS supplier/plant impact tagging to track tariff exposure by SHS spend buckets (imaging, diagnostics, Varian, services).",
      "Build SHS-specific HTS code library for common procurement categories (CT detectors, MRI magnets, X-ray tubes, reagents, PPE).",
      "Add pharma investment exemption tracker — monitor which companies have filed investment pledges for branded pharma 100% tariff exemption."
    ];

    function sourceLink(id) {
      const src = SOURCEBOOK[id];
      if (!src) return "";
      const note = src.note ? ` <span style=\"color:var(--muted);\">(${src.note})</span>` : "";
      return `<a href="${src.url}" target="_blank" rel="noopener noreferrer">${src.title}</a>${note}`;
    }

    function statusPill(status) {
      const lower = status.toLowerCase();
      if (lower.includes("active")) return `<span class="status-pill status-active">ACTIVE</span>`;
      if (lower.includes("watch") || lower.includes("conditional")) return `<span class="status-pill status-watch">WATCH</span>`;
      return `<span class="status-pill status-risk">CONTESTED/RISK</span>`;
    }

    function escapeHtml(value) {
      return String(value ?? "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function formatMoney(value) {
      const safe = Number.isFinite(value) ? value : 0;
      return new Intl.NumberFormat("en-US", { style: "currency", currency: "USD", maximumFractionDigits: 2 }).format(safe);
    }

    function formatPercent(value) {
      const safe = Number.isFinite(value) ? value : 0;
      return `${safe.toFixed(2)}%`;
    }

    function toNumber(value) {
      const parsed = parseFloat(String(value ?? "").trim());
      return Number.isFinite(parsed) ? parsed : 0;
    }

    function toIsoDate(value) {
      if (!value) return "";
      const parsed = new Date(value);
      if (Number.isNaN(parsed.getTime())) return String(value);
      return parsed.toISOString().slice(0, 10);
    }

    function sortByDateDesc(a, b) {
      const ad = new Date(a.date || "").getTime();
      const bd = new Date(b.date || "").getTime();
      const safeA = Number.isFinite(ad) ? ad : 0;
      const safeB = Number.isFinite(bd) ? bd : 0;
      return safeB - safeA;
    }

    function renderHeadlineTicker(items) {
      const track = document.getElementById("headlineTicker");
      if (!track) return;

      const fallback = [
        "Monitoring Federal Register tariff and trade-rule publications",
        "Monitoring CBP CSMS operational implementation notices",
        "Monitoring official retaliation and countermeasure channels"
      ];
      const selected = (items || [])
        .map((item) => String(item || "").trim())
        .filter(Boolean)
        .slice(0, 12);
      const rows = selected.length ? selected : fallback;
      const doubled = [...rows, ...rows];
      track.innerHTML = doubled.map((headline) => `<span class="ticker-item">${escapeHtml(headline)}</span>`).join("");
    }

    function applySectionRevealAnimation() {
      const visibleRoot = document.querySelector(".view.active") || document;
      const targets = Array.from(visibleRoot.querySelectorAll(".kpi, .panel, .table-wrap, .source-list, .event, .metric"));
      targets.forEach((element, index) => {
        element.style.animation = "none";
        element.offsetHeight; // force reflow to restart animation
        element.style.animation = `riseIn 280ms ease both`;
        element.style.animationDelay = `${Math.min(index * 18, 300)}ms`;
      });
    }

    function animateKpiCountUp() {
      // Animate KPI value display with a fast count-up effect on page load
      document.querySelectorAll(".kpi .value").forEach((el) => {
        const raw = el.dataset.target || el.textContent;
        // Extract leading prefix (€$~), numeric part, suffix
        const m = raw.match(/^([€$~\s]*)(\d[\d,.]*)(.*?)$/);
        if (!m) return;
        const prefix = m[1] || "";
        const numStr = m[2].replace(/,/g, "");
        const suffix = m[3] || "";
        const target = parseFloat(numStr);
        if (!isFinite(target) || target === 0) return;

        const isLarge = target >= 100;
        const duration = 900;
        const steps = 32;
        const interval = duration / steps;
        let step = 0;

        const ticker = setInterval(() => {
          step++;
          const progress = step / steps;
          const eased = 1 - Math.pow(1 - progress, 3); // ease-out-cubic
          const current = target * eased;
          const formatted = isLarge
            ? Math.round(current).toLocaleString("en-US")
            : (current).toPrecision(3).replace(/\.?0+$/, "");
          el.textContent = prefix + formatted + suffix;
          if (step >= steps) {
            clearInterval(ticker);
            el.textContent = raw; // restore exact original
          }
        }, interval);
      });
    }

    function canonicalCountry(input) {
      if (!input) return "";
      const trimmed = input.trim();
      if (!trimmed) return "";
      return COUNTRY_ALIASES[trimmed] || trimmed;
    }

    function isEuMember(country) {
      return EU_MEMBERS.includes(country);
    }

    function reciprocalText(country) {
      if (country === "China") {
        return "IEEPA-derived tariffs STRUCK DOWN by SCOTUS Feb 20, 2026. China-specific heightened reciprocal layers and opioid-linked duties are no longer enforceable. Active measures remain: Section 301 strategic products, Section 232 commodities, Section 122 global surcharge (10%, Feb 24 2026 proclamation).";
      }
      if (country === "EU" || isEuMember(country)) {
        return "IEEPA-derived EU formula rate STRUCK DOWN by SCOTUS Feb 20, 2026. The EU Annex formula (max(0, 15% - MFN rate)) is no longer operative. Active measures: Section 232 (steel 50%, auto 25%, semi 25%); Section 122 global surcharge (10%, Feb 24 2026 proclamation).";
      }
      const annex = ANNEX_RATES[country];
      if (annex) {
        return `IEEPA Annex I adjusted reciprocal rate of ${annex} has been STRUCK DOWN by SCOTUS Feb 20, 2026 and is no longer enforceable. Active measures now are Section 232 commodity programs and the new Section 122 global surcharge (10%, effective Feb 24 2026 under proclamation).`;
      }
      return "IEEPA default reciprocal baseline (10%) STRUCK DOWN by SCOTUS Feb 20, 2026. Active measures: Section 232 commodity programs and Section 122 global surcharge (10%, effective Feb 24 2026 under proclamation).";
    }

    function countrySummary(country) {
      if (!country) return "Select a country to load analysis.";

      const euTag = isEuMember(country) ? " This country is treated as an EU member for framework/countermeasure context." : "";

      if (country === "Canada") {
        return "Canada has major exposure to Section 232 metals (50%) and vehicles (25%), plus the Section 122 global surcharge (operatively 10% under the Feb 20 proclamation for covered non-exempt goods from Feb 24, 2026). IEEPA northern-border duties (35% non-USMCA / 10% energy/potash) were STRUCK DOWN by the SCOTUS Feb 20 ruling. USMCA-compliant goods are also excepted from the Section 122 layer under the proclamation. Canada maintains active countermeasures on U.S. steel, aluminum, and automobiles; broad 2025 retaliatory tariffs removed Sep 2025. Key source: Government of Canada Finance.";
      }
      if (country === "Mexico") {
        return "Mexico faces Section 232 on metals/vehicles and the Section 122 global surcharge (operatively 10% for covered non-exempt goods). IEEPA southern-border duties (25% non-USMCA) were STRUCK DOWN by SCOTUS Feb 20 ruling. USMCA-compliant goods are excepted from the Section 122 layer under the proclamation. Mexico's retaliatory posture is limited — no comprehensive retaliation schedule confirmed. Section 301 China measures do not apply to Mexican-origin goods unless transshipped.";
      }
      if (country === "China") {
        return "China remains the highest-risk jurisdiction. Active measures: Section 301 strategic products (EVs, batteries, solar, cranes, selected medical — rates 25–100%+); Section 232 steel/aluminum (50%) and semiconductors (25%); Section 122 global surcharge (operatively 10% from Feb 24 for covered non-exempt goods). IEEPA-derived heightened reciprocal tariffs and opioid duties were STRUCK DOWN by SCOTUS Feb 20. U.S.-PRC arrangement suspended PRC retaliatory ag tariffs through Nov 10, 2026. For Siemens Healthineers: China-origin electronics, detector components, and PPE can still face cumulative exposure where Section 122 applies and no exception/non-stacking rule blocks it.";
      }
      if (country === "United Kingdom") {
        return "The UK has the most favorable tariff position for Siemens Healthineers procurement. U.S.-UK Economic Prosperity Deal (EO 14305) provides: steel/aluminum at 25% (carve-out from 50%); auto TRQ 100,000 units at combined 10%; 0% on pharmaceutical and medtech exports. Section 122 (10% under the Feb 20 proclamation) can still apply to covered non-exempt goods. UK pharma/medtech 0% tariff is a significant SHS sourcing advantage — verify HTS classification to confirm eligibility.";
      }
      if (country === "Japan") {
        return "Japan has dedicated treatment via EO 14345: 15% total tariff floor for qualifying auto and reciprocal pathways. Section 232 steel/aluminum at 50% (no Japan-specific exemption). Section 122 global surcharge (operatively 10% under the Feb 20 proclamation) applies to covered non-exempt goods. IEEPA Annex I rate was 15% — now moot after SCOTUS ruling. Japan has not announced formal retaliatory tariffs but is engaged in ongoing trade talks. Key supply for SHS: precision components, optical systems, medical electronics.";
      }
      if (country === "India") {
        return "India had IEEPA reciprocal rate of 25% (now moot post-SCOTUS Feb 20) and was removed from Russia-linked 25% secondary duty effective Feb 7, 2026. U.S.-India Interim Agreement reduces certain goods to 18% reciprocal rate — bilateral framework may survive separate from IEEPA. Section 232 metals (50%), autos (25%), and the Section 122 global surcharge (operatively 10% for covered non-exempt goods from Feb 24) all apply. India is a critical source for SHS APIs/generic pharma; pharmaceuticals/pharmaceutical ingredients appear exempt from Section 122, but the Section 232 pharma investigation poses medium-term risk. India has not formally retaliated but may pursue WTO dispute mechanisms.";
      }
      if (country === "Brazil") {
        return "Brazil had an IEEPA Annex I rate of 10% plus a 40% targeted duty on specific Annex-listed products — both STRUCK DOWN by SCOTUS Feb 20, 2026. Section 122 global surcharge (operatively 10% for covered non-exempt goods from Feb 24) applies. Section 232 metals (50%) apply. Brazil had imposed limited WTO-framework retaliatory measures. Monitor EO 14323 enforcement status closely.";
      }
      if (country === "South Korea") {
        return "South Korea had IEEPA Annex I rate of 15% (now moot post-SCOTUS). Section 232 steel/aluminum at 50%, autos at 25%, semiconductors at 25%, and Section 122 (operatively 10% for covered non-exempt goods) all apply. U.S.-Japan deal framework provides a reference for potential bilateral negotiations. South Korea is a critical SHS supply chain node for memory chips, display panels, and precision manufacturing. No formal US-Korea bilateral trade deal announced.";
      }
      if (country === "Taiwan") {
        return "Taiwan had IEEPA Annex I rate of 20% (now moot post-SCOTUS). Section 232 semiconductors (25%) is highly relevant — Taiwan is the dominant source of advanced chips (TSMC), which are inputs in medical imaging systems. Section 122 (operatively 10% for covered non-exempt goods) also applies. No bilateral deal. Taiwan faces geopolitical risk overlapping with tariff risk for supply chain continuity.";
      }
      if (country === "Germany" || country === "France" || country === "Italy" || country === "Netherlands" || isEuMember(country)) {
        const euRateNote = `KEY ADVANTAGE: U.S.-EU Framework Agreement (Aug 21, 2025, pharma effective Sep 1, 2025) caps EU pharmaceutical and medtech tariffs at a maximum 15% ceiling — the 100% branded-pharma rate does NOT apply to EU/German-origin products. EU generic pharma receives MFN rates (~0%). IEEPA EU formula rate: now moot post-SCOTUS. Section 122 global surcharge is operatively 10% (not 15%) under the Feb 20 proclamation and applies only to covered non-exempt goods. Section 232 steel/aluminum at 50%; autos 25%; advanced semiconductors 25% (narrow scope). Germany is SHS home country and key manufacturing base — pharma/medtech shipped from Germany to U.S. benefits from the 15% EU ceiling rather than the global 100% branded-pharma rate.`;
        return euRateNote;
      }
      if (country === "EU") {
        return "European Union: IEEPA formula rate (contested, now moot post-SCOTUS) was: max(0, 15% - Column 1 MFN rate). Section 122 global surcharge is operatively 10% from Feb 24 under the White House proclamation for covered non-exempt goods. Section 232 programs (steel 50%, auto 25%, semi 25%) apply to all EU member goods, and Section 232-covered goods are excepted from the §122 layer. EU-U.S. trade framework negotiations ongoing; no formal retaliation yet. EU is SHS primary manufacturing base.";
      }
      if (country === "Vietnam") {
        return "Vietnam had IEEPA Annex I rate of 20% (now moot post-SCOTUS). Section 122 (operatively 10% for covered non-exempt goods) applies from Feb 24. Section 232 steel/aluminum (50%) applies. Vietnam is a growing source of electronics and medical device components. China transshipment risk: CBP has tightened anti-circumvention enforcement; goods routed through Vietnam to avoid China Section 301 tariffs face seizure risk.";
      }
      if (country === "Singapore") {
        return "Singapore: No IEEPA Annex I rate listed; defaulted to 10% baseline (now moot). Section 122 (operatively 10% for covered non-exempt goods) applies from Feb 24. Section 232 programs apply. Singapore is a key logistics and distribution hub; verify origin rules carefully for goods transiting Singapore — MFN origin, not shipping origin, determines tariff treatment.";
      }
      if (country === "Switzerland") {
        return "Switzerland had one of the highest IEEPA Annex I rates at 39% (now moot post-SCOTUS). Section 122 (operatively 10% for covered non-exempt goods) applies. Section 232 metals (50%) apply. Switzerland is a critical source for SHS high-precision instruments, watch/clock components, and specialty pharma. Swiss pharma/medtech sector is closely monitoring the Section 122 exception for pharmaceuticals.";
      }

      return `Primary active exposure is through Section 232 product programs (metals, vehicles, timber, copper, semiconductors) and the Section 122 global surcharge (operatively 10% under the Feb 20 proclamation, effective Feb 24 2026 for covered non-exempt goods). ${reciprocalText(country)}${euTag}`;
    }

    function buildActiveRows(country) {
      const rows = [];

      const steelRate = country === "United Kingdom" ? "25% (UK carve-out currently in place; subject to revision)" : "50%";
      rows.push({
        measure: "Section 232 steel & aluminum",
        scope: "Steel/aluminum articles and derivatives (commodity-specific HTS scope)",
        tariff: steelRate,
        status: "Active",
        effective: "2025-06-04",
        sourceIds: ["fr_steel_2025", "fr_aluminum_2025", "fr_steel_al_50", "fr_uk_deal"]
      });

      let autoTariff = "25% on autos; 25% on covered parts (with U.S.-content and manufacturer offset rules).";
      if (country === "United Kingdom") {
        autoTariff = "UK autos: annual TRQ up to 100,000 units at combined 10%; over-quota follows base Section 232. UK-linked parts can receive 10% pathway under agreement terms.";
      } else if (country === "Japan") {
        autoTariff = "U.S.-Japan order applies 15% total tariff floor logic for qualifying automobiles and parts pathways.";
      }

      rows.push({
        measure: "Section 232 automobiles & parts",
        scope: "Passenger vehicles, light trucks, listed engines/powertrain/electrical part families, and added parts by FR notice",
        tariff: autoTariff,
        status: "Active",
        effective: "Autos 2025-04-03; parts 2025-05-03",
        sourceIds: ["fr_autos", "fr_autos_amend", "fr_uk_deal", "fr_japan_deal"]
      });

      rows.push({
        measure: "Section 232 medium/heavy vehicles and buses",
        scope: "MHDVs, listed MHDV parts, and buses",
        tariff: "25% for MHDVs and listed parts; 10% for buses (HTS 8702)",
        status: "Active",
        effective: "2025-11-01",
        sourceIds: ["fr_mhdv"]
      });

      rows.push({
        measure: "Section 232 copper",
        scope: "Annex-listed semi-finished copper products and intensive copper derivatives",
        tariff: "50%",
        status: "Active",
        effective: "2025-08-01",
        sourceIds: ["fr_copper"]
      });

      rows.push({
        measure: "Section 232 timber/lumber",
        scope: "Softwood timber/lumber + listed upholstered wood products + cabinets/vanities",
        tariff: "10% softwood; 25% listed wood derivatives; planned 30%/50% escalation deferred to 2027-01-01",
        status: "Active",
        effective: "2025-10-14",
        sourceIds: ["fr_timber", "fr_timber_amend"]
      });

      rows.push({
        measure: "Section 232 semiconductors and manufacturing equipment",
        scope: "Covered semiconductors, semiconductor manufacturing equipment, and derivative products",
        tariff: "25% on covered products, with specified exception pathways",
        status: "Active",
        effective: "2026-01-15",
        sourceIds: ["fr_semis"]
      });

      rows.push({
        measure: "Global de minimis treatment change",
        scope: "Low-value shipments; postal and non-postal channels",
        tariff: "Duty-free de minimis suspended for covered goods; postal duties use IEEPA-rate-based methods",
        status: "Active",
        effective: "2025-08-29",
        sourceIds: ["fr_de_minimis"]
      });

      rows.push({
        measure: "Section 122 global import surcharge",
        scope: "Covered imports from ALL countries. Proclamation exceptions include pharmaceuticals/pharmaceutical ingredients (incl. diagnostic reagents), certain agriculture (beef, tomatoes, oranges), critical minerals & metals, some electronics, passenger vehicles and many vehicle categories/parts, USMCA-qualifying Canada/Mexico goods, and all goods already subject to Section 232 tariffs (no stacking — steel, aluminum, autos, copper, lumber, semiconductors, etc. exempt from the §122 layer).",
        tariff: "10% ad valorem under Feb 20, 2026 White House proclamation. Trade Act §122 statutory maximum is 15%. Duration ~150 days from Feb 24; expires approx. Jul 24, 2026 without Congressional extension.",
        status: "Active",
        effective: "2026-02-24",
        sourceIds: ["wh_section122_proclamation", "wh_section122_factsheet", "axios_section122"]
      });

      if (country === "United Kingdom") {
        rows.push({
          measure: "U.S.-UK pharma/medtech zero tariff",
          scope: "Pharmaceutical and medical technology exports from the United Kingdom to the United States",
          tariff: "0% tariff on qualifying UK pharma/medtech exports under U.S.-UK Economic Prosperity Deal",
          status: "Active",
          effective: "2025-06-23 (EO 14305)",
          sourceIds: ["fr_uk_deal", "fr_uk_pharma"]
        });
      }

      if (country === "China") {
        rows.push({
          measure: "Section 301 strategic products (China)",
          scope: "EVs, batteries, solar cells, critical minerals, semiconductors, cranes, selected medical products",
          tariff: "Product-specific elevated duties (including very high rate tiers)",
          status: "Active",
          effective: "Phased since 2024",
          sourceIds: ["ustr_301_2024"]
        });
      }

      return rows;
    }

    function buildContestedRows(country) {
      const rows = [];

      rows.push({
        measure: "IEEPA reciprocal tariff framework — STRUCK DOWN",
        scope: "General goods imports by country schedule and exclusions",
        tariff: reciprocalText(country),
        status: "Contested",
        effective: "Program invalid as of SCOTUS ruling Feb 20, 2026 — awaiting CBP unwinding guidance",
        sourceIds: ["fr_reciprocal_base", "wh_reciprocal_july", "fr_reciprocal_july", "scotus_case", "scotus_pdf", "scotusblog_ieepa", "budgetlab_scotus"]
      });

      if (country === "Canada") {
        rows.push({
          measure: "IEEPA northern-border duties (Canada)",
          scope: "Non-USMCA Canadian goods, with energy/potash treatment",
          tariff: "35% non-USMCA goods; 10% on energy/potash non-USMCA buckets; USMCA goods excluded under amendment terms",
          status: "Contested",
          effective: "35% layer from 2025-08-01",
          sourceIds: ["fr_canada_ieepa", "fr_canada_usmca", "fr_canada_35", "scotus_case"]
        });
      }

      if (country === "Mexico") {
        rows.push({
          measure: "IEEPA southern-border duties (Mexico)",
          scope: "Non-USMCA Mexican goods, with potash treatment",
          tariff: "25% non-USMCA goods; potash treatment set to 10%; USMCA goods excluded under amendment terms",
          status: "Contested",
          effective: "Base layer 2025-02-04; key amendment 2025-03-07",
          sourceIds: ["fr_mexico_ieepa", "fr_mexico_usmca", "scotus_case"]
        });
      }

      if (country === "China") {
        rows.push({
          measure: "IEEPA opioid-linked duties (PRC)",
          scope: "Products of PRC as defined in implementing notices",
          tariff: "Currently 10% (reduced from 20% effective 2025-11-10 under arrangement terms)",
          status: "Contested",
          effective: "10% baseline 2025-02-04; 20% in 2025-03; reverted to 10% in 2025-11",
          sourceIds: ["fr_china_opioid", "scotus_case", "fr_non_stacking"]
        });
      }

      if (country === "Brazil") {
        rows.push({
          measure: "Targeted emergency order on products of Brazil",
          scope: "Annex-defined products of Brazil",
          tariff: "40% additional ad valorem",
          status: "Contested",
          effective: "2025-08-06 publication / order effect per text",
          sourceIds: ["fr_brazil_40", "scotus_case"]
        });
      }

      if (country === "India") {
        rows.push({
          measure: "Russia-linked secondary duty status",
          scope: "Countries deemed to directly/indirectly import Russian oil under EO 14329 framework",
          tariff: "India-specific 25% additional duty removed by modification order",
          status: "Watch",
          effective: "Relief effective 2026-02-07",
          sourceIds: ["fr_russia_oil", "fr_russia_india_relief"]
        });
      }

      if (country === "Iran" || country === "Cuba") {
        rows.push({
          measure: "Country-linked secondary tariff mechanism",
          scope: "Third-country goods tied to specified oil/goods-service transactions",
          tariff: "Additional ad valorem duties may be imposed after agency determination",
          status: "Watch",
          effective: "2026-02 orders",
          sourceIds: country === "Iran" ? ["fr_iran_secondary"] : ["fr_cuba_secondary"]
        });
      }

      return rows;
    }

    function buildRetaliationRows(country) {
      if (country === "Canada") {
        return [{
          jurisdiction: "Canada",
          countermeasure: "Counter tariffs remain active on U.S. steel, aluminum, and automobiles while broader March 2025 counter tariffs were removed for most goods.",
          scope: "Steel, aluminum, non-CUSMA vehicles, and non-Canadian/non-Mexican content rules in listed vehicle categories.",
          status: "Active",
          effective: "Most broad tariffs removed 2025-09-01; steel/aluminum/auto countermeasures remain",
          sourceIds: ["canada_response"]
        }];
      }

      if (country === "China") {
        return [{
          jurisdiction: "PRC (as described in U.S.-PRC arrangement text)",
          countermeasure: "PRC committed to suspend tariffs on many U.S. agricultural products until 2026-12-31 and extend market-based tariff exclusion process until 2026-11-10.",
          scope: "Large set of U.S. agricultural products; other retaliatory tools addressed in arrangement text.",
          status: "Watch",
          effective: "Commitment framework announced 2025-11",
          sourceIds: ["wh_china_nov", "fr_china_nov"]
        }];
      }

      if (country === "EU" || isEuMember(country)) {
        return [{
          jurisdiction: "European Union",
          countermeasure: "EU paused planned retaliation while engaging in trade negotiations with the U.S. EU has identified a list of U.S. goods for potential counter-tariffs (American whiskey, motorcycles, orange juice, peanut butter, tobacco) but has not implemented. EU Trade Commissioner has indicated potential response if U.S. Section 232 on EU goods is not addressed. Post-SCOTUS ruling, EU watching Section 122 carefully.",
          scope: "Potential retaliation list includes bourbon, motorcycles, agricultural products, some manufactured goods. EU internal market of ~450M consumers.",
          status: "Watch",
          effective: "Framework negotiations ongoing; no formal retaliation imposed as of Feb 2026",
          sourceIds: ["fr_reciprocal_july", "fr_scope_framework"]
        }];
      }

      if (country === "India") {
        return [{
          jurisdiction: "India",
          countermeasure: "India has not imposed broad retaliatory tariffs against the U.S. but filed WTO dispute settlement proceedings. U.S.-India Interim Agreement (Feb 2026) framework suggests both sides seeking negotiated resolution. India may impose reciprocal tariffs on selected U.S. goods if negotiations stall.",
          scope: "Potential retaliation targets: U.S. almonds, walnuts, apples, selected manufactured goods. WTO Article XXVIII consultations ongoing.",
          status: "Watch",
          effective: "No formal retaliation as of Feb 2026; WTO proceedings initiated",
          sourceIds: ["fr_russia_india_relief", "fr_india_interim"]
        }];
      }

      if (country === "Japan") {
        return [{
          jurisdiction: "Japan",
          countermeasure: "Japan has not imposed retaliatory tariffs. U.S.-Japan Agreement (EO 14345, Sep 2025) provides a negotiated framework for autos and selected goods at 15% total floor. Japan is engaging in ongoing bilateral talks to reduce Section 232 exposure. Japan filed WTO notifications on Section 232 steel/aluminum as protective measure.",
          scope: "WTO notifications on steel/aluminum. No unilateral retaliatory tariffs imposed.",
          status: "Watch",
          effective: "U.S.-Japan Agreement effective Sep 2025; WTO consultations ongoing",
          sourceIds: ["fr_japan_deal"]
        }];
      }

      if (country === "South Korea") {
        return [{
          jurisdiction: "South Korea",
          countermeasure: "South Korea has engaged U.S. in bilateral negotiations seeking treatment similar to Japan's EO 14345 framework. No formal retaliatory tariffs imposed. Korea filed WTO consultations on Section 232 steel/aluminum. Korea's semiconductor exports (Samsung, SK Hynix) face Section 232 25% tariff — a major bilateral trade irritant.",
          scope: "WTO consultations on steel/aluminum. Samsung, SK Hynix flagged Section 232 semiconductor impact.",
          status: "Watch",
          effective: "No formal retaliation; WTO consultations active",
          sourceIds: []
        }];
      }

      if (country === "Taiwan") {
        return [{
          jurisdiction: "Taiwan",
          countermeasure: "Taiwan has not formally retaliated. TSMC announced $100B+ U.S. investment in semiconductor fabs — a mitigation strategy providing political leverage for tariff relief. Taiwan is engaging U.S. USTR on bilateral trade framework discussions.",
          scope: "TSMC U.S. fab investment (Arizona) as tariff mitigation/goodwill. No tariff retaliation.",
          status: "Watch",
          effective: "Investment commitments ongoing; no formal retaliation",
          sourceIds: []
        }];
      }

      if (country === "Switzerland") {
        return [{
          jurisdiction: "Switzerland",
          countermeasure: "Switzerland has not imposed formal retaliatory tariffs. Switzerland typically pursues WTO dispute resolution rather than unilateral retaliation. Swiss pharma industry (Novartis, Roche) has secured 3-year pharma tariff exemptions via U.S. manufacturing investment pledges.",
          scope: "Pharma company-level exemption deals (Novartis, others). WTO dispute framework.",
          status: "Watch",
          effective: "No formal retaliation; pharma company deals active",
          sourceIds: []
        }];
      }

      return [{
        jurisdiction: country,
        countermeasure: "No consolidated official national counter-tariff schedule is currently wired into this dashboard for this jurisdiction. Check country's customs/finance ministry website for retaliatory measures.",
        scope: "Requires country-specific customs/finance ministry integration for definitive product-level response status.",
        status: "Watch",
        effective: "Data gap — verify with official sources",
        sourceIds: []
      }];
    }

    function collectSourcesFromRows(rows) {
      const ids = new Set();
      rows.forEach((row) => {
        (row.sourceIds || []).forEach((id) => ids.add(id));
      });
      return Array.from(ids);
    }

    function renderKpis() {
      const kpis = [
        { label: "Active Tariff Commodity Programs", value: "12", sub: "S.232 · S.301 · S.122" },
        { label: "Latest Published Effective Tariff Estimate",  value: "13.7%", sub: "Yale Budget Lab (Feb 21, 2026 published estimate) · monitor for update after operative 10% Section 122 clarification" },
        { label: "2025 U.S. Tariff Revenue",         value: "$287B",  sub: "+192% vs 2024" },
        { label: "SHS Projected FY2026 Impact",       value: "€400M",  sub: "~2× FY2025 · Bloomberg" }
      ];
      const grid = document.getElementById("kpiGrid");
      grid.innerHTML = kpis.map((k) =>
        `<div class="kpi">
          <div class="label">${k.label}</div>
          <div class="value" data-target="${k.value}">${k.value}</div>
          ${k.sub ? `<div class="sub">${k.sub}</div>` : ""}
        </div>`
      ).join("");
    }

    function renderCountry(countryInput) {
      const canonical = canonicalCountry(countryInput);
      const country = canonical || "Canada";

      const activeRows = buildActiveRows(country);
      const contestedRows = buildContestedRows(country);
      const retaliationRows = buildRetaliationRows(country);

      const badgeBits = [];
      if (ANNEX_RATES[country]) badgeBits.push(`<span class=\"chip\"><b>Annex I rate:</b> ${ANNEX_RATES[country]}</span>`);
      if (isEuMember(country)) badgeBits.push(`<span class=\"chip\"><b>Region logic:</b> EU member treatment</span>`);
      if (country === "EU") badgeBits.push(`<span class=\"chip\"><b>Region:</b> European Union</span>`);
      if (!ANNEX_RATES[country] && country !== "China" && country !== "EU" && !isEuMember(country)) {
        badgeBits.push(`<span class=\"chip\"><b>Default reciprocal bucket:</b> 10% (contested)</span>`);
      }

      document.getElementById("countryTitle").textContent = country;
      document.getElementById("countryBadges").innerHTML = badgeBits.join("");
      document.getElementById("countrySummaryText").textContent = countrySummary(country);

      const usTbody = document.querySelector("#usMeasureTable tbody");
      const merged = [
        ...activeRows.map((r) => ({ ...r, stateLabel: "Active" })),
        ...contestedRows.map((r) => ({ ...r, stateLabel: r.status.includes("Watch") ? "Watch" : "Contested" }))
      ];

      usTbody.innerHTML = merged
        .map((r) => `
          <tr>
            <td>${r.measure}</td>
            <td>${r.scope}</td>
            <td>${r.tariff}</td>
            <td>${statusPill(r.status)}</td>
            <td>${r.effective}</td>
          </tr>
        `)
        .join("");

      const retaliTbody = document.querySelector("#retaliationTable tbody");
      retaliTbody.innerHTML = retaliationRows
        .map((r) => `
          <tr>
            <td>${r.jurisdiction}</td>
            <td>${r.countermeasure}</td>
            <td>${r.scope}</td>
            <td>${statusPill(r.status)}</td>
            <td>${r.effective}</td>
          </tr>
        `)
        .join("");

      const sourceIds = new Set([...collectSourcesFromRows(merged), ...collectSourcesFromRows(retaliationRows)]);
      const sourceList = document.getElementById("countrySourceLinks");
      sourceList.innerHTML = Array.from(sourceIds)
        .filter((id) => SOURCEBOOK[id])
        .map((id) => `<li>${sourceLink(id)}</li>`)
        .join("");
    }

    function rateClass(treatment) {
      // Extract first numeric rate from treatment string for heat coloring
      const m = treatment.match(/(\d+)%/);
      if (!m) return "";
      const r = parseInt(m[1], 10);
      if (r >= 50) return "rate-danger";
      if (r >= 25) return "rate-high";
      if (r >= 15) return "rate-mid";
      return "rate-low";
    }

    function renderCommodities() {
      const tbody = document.querySelector("#commodityTable tbody");
      tbody.innerHTML = COMMODITY_ROWS
        .map((row) => `
          <tr>
            <td><strong>${row.commodity}</strong></td>
            <td class="${rateClass(row.treatment)}">${row.treatment}</td>
            <td>${row.coverage}</td>
            <td>${statusPill(row.status)}</td>
            <td>${row.sourceIds.map((id) => sourceLink(id)).join(" · ")}</td>
          </tr>
        `)
        .join("");
    }

    function eventBadge(item) {
      const t = (item.meta || "").toLowerCase();
      const e = (item.event || "").toLowerCase();
      if (t.includes("scotus") || e.includes("supreme court") || e.includes("scotus")) return '<span class="event-badge badge-scotus">SCOTUS</span>';
      if (t.includes("122") || e.includes("section 122")) return '<span class="event-badge badge-122">S.122</span>';
      if (e.includes("ieepa") || t.includes("ieepa")) return '<span class="event-badge badge-ieepa">IEEPA</span>';
      if (e.includes("retaliat") || t.includes("retaliat")) return '<span class="event-badge badge-ret">RETALIATION</span>';
      if (e.includes("section 301") || t.includes("301")) return '<span class="event-badge badge-301">S.301</span>';
      if (e.includes("section 232") || t.includes("232")) return '<span class="event-badge badge-232">S.232</span>';
      return '';
    }

    function renderTimeline() {
      const list = document.getElementById("timelineList");
      list.innerHTML = TIMELINE
        .map((item) => `
          <li class="event">
            ${eventBadge(item)}
            <div class="date">${item.date}</div>
            <p class="desc">${item.event}</p>
            <div class="meta">${item.meta}${item.sourceIds.length ? " · " + item.sourceIds.map((id) => sourceLink(id)).join(" · ") : ""}</div>
          </li>
        `)
        .join("");
    }

    function renderSources() {
      const list = document.getElementById("sourceList");
      const entries = Object.entries(SOURCEBOOK);
      list.innerHTML = entries
        .map(([, src]) => `<li><a href="${src.url}" target="_blank" rel="noopener noreferrer">${src.title}</a>${src.note ? ` <span style=\"color:var(--muted);\">(${src.note})</span>` : ""}</li>`)
        .join("");
    }

    function renderGaps() {
      document.getElementById("gapList").innerHTML = GAPS.map((x) => `<li>${x}</li>`).join("");
      document.getElementById("backlogList").innerHTML = BACKLOG.map((x) => `<li>${x}</li>`).join("");
    }

    function sourceAnchor(url, title) {
      if (!url) return escapeHtml(title || "No link");
      return `<a href="${escapeHtml(url)}" target="_blank" rel="noopener noreferrer">${escapeHtml(title || url)}</a>`;
    }

    function renderLiveFeeds(payload) {
      const frFeed = payload?.feeds?.federal_register || {};
      const cbpFeed = payload?.feeds?.cbp_csms || {};
      const retaliation = payload?.feeds?.retaliation || {};
      const euFeed = retaliation.eu_commission || {};
      const ukFeed = retaliation.uk_dbt || {};
      const chinaFeed = retaliation.china_mofcom || {};
      const canadaFeed = retaliation.canada_finance || {};

      const frItems = Array.isArray(frFeed.items) ? frFeed.items : [];
      const cbpItems = Array.isArray(cbpFeed.items) ? cbpFeed.items : [];

      const retaliationRows = [];
      const retaliationFeeds = [
        { jurisdiction: "European Union", label: "EU Commission", feed: euFeed },
        { jurisdiction: "United Kingdom", label: "UK DBT", feed: ukFeed },
        { jurisdiction: "China", label: "MOFCOM (EN)", feed: chinaFeed },
        { jurisdiction: "Canada", label: "Canada Finance", feed: canadaFeed }
      ];

      retaliationFeeds.forEach((entry) => {
        const items = Array.isArray(entry.feed.items) ? entry.feed.items : [];
        items.forEach((item) => {
          retaliationRows.push({
            jurisdiction: entry.jurisdiction,
            date: item.publication_date || item.pub_date || item.updated || "",
            title: item.title || "Untitled item",
            link: item.link || item.html_url || entry.feed.source_url || "",
            feed: entry.label
          });
        });
      });
      retaliationRows.sort(sortByDateDesc);

      const generatedAt = payload?.generated_at || "";
      const liveSummary = document.getElementById("liveSummary");
      liveSummary.innerHTML = [
        { label: "Generated (UTC)", value: generatedAt || "N/A" },
        { label: "Federal Register docs", value: `${frItems.length}` },
        { label: "CBP CSMS items", value: `${cbpItems.length}` },
        { label: "Retaliation watch items", value: `${retaliationRows.length}` }
      ]
        .map((card) => `<div class="kpi"><div class="label">${escapeHtml(card.label)}</div><div class="value">${escapeHtml(card.value)}</div></div>`)
        .join("");

      const frBody = document.querySelector("#liveFrTable tbody");
      frBody.innerHTML = frItems.length
        ? frItems.slice(0, 25).map((item) => `
          <tr>
            <td>${escapeHtml(toIsoDate(item.publication_date))}</td>
            <td>${escapeHtml(item.type || "Doc")}</td>
            <td>${sourceAnchor(item.html_url || item.raw_text_url, item.title || item.document_number || "Federal Register document")}</td>
            <td>${escapeHtml(item.term_hit || "")}</td>
          </tr>
        `).join("")
        : `<tr><td colspan="4">No Federal Register items loaded.</td></tr>`;

      const cbpBody = document.querySelector("#liveCbpTable tbody");
      cbpBody.innerHTML = cbpItems.length
        ? cbpItems.slice(0, 25).map((item) => `
          <tr>
            <td>${escapeHtml(toIsoDate(item.pub_date) || item.pub_date || "")}</td>
            <td>${sourceAnchor(item.link, item.title || "CBP CSMS item")}</td>
          </tr>
        `).join("")
        : `<tr><td colspan="2">No CBP CSMS items loaded.</td></tr>`;

      const retBody = document.querySelector("#liveRetaliationTable tbody");
      retBody.innerHTML = retaliationRows.length
        ? retaliationRows.slice(0, 30).map((item) => `
          <tr>
            <td>${escapeHtml(item.jurisdiction)}</td>
            <td>${escapeHtml(toIsoDate(item.date) || item.date || "")}</td>
            <td>${sourceAnchor(item.link, item.title)}</td>
            <td>${escapeHtml(item.feed)}</td>
          </tr>
        `).join("")
        : `<tr><td colspan="4">No retaliation-feed entries loaded.</td></tr>`;

      const tickerRows = [
        ...cbpItems.slice(0, 4).map((item) => `CBP: ${item.title || "Operational notice"}`),
        ...frItems.slice(0, 4).map((item) => `FR: ${item.title || item.document_number || "Regulatory notice"}`),
        ...retaliationRows.slice(0, 4).map((item) => `${item.jurisdiction}: ${item.title || "Policy update"}`)
      ];
      renderHeadlineTicker(tickerRows);

      const errors = [];
      [frFeed, cbpFeed, euFeed, ukFeed, chinaFeed, canadaFeed].forEach((feed) => {
        const feedErrors = Array.isArray(feed.errors) ? feed.errors : [];
        feedErrors.forEach((err) => errors.push(`${feed.source || "Feed"}: ${err}`));
      });

      const health = document.getElementById("liveFeedErrors");
      if (errors.length) {
        health.innerHTML = `
          <h3>Feed Health</h3>
          <ul>${errors.map((err) => `<li>${escapeHtml(err)}</li>`).join("")}</ul>
        `;
      } else {
        health.innerHTML = `
          <h3>Feed Health</h3>
          <p class="small-note" style="margin:0;">All configured feeds loaded successfully in the latest run.</p>
        `;
      }

      const generatedDate = toIsoDate(generatedAt);
      if (generatedDate) {
        document.getElementById("lastVerified").textContent = generatedDate;
      }

      applySectionRevealAnimation();
    }

    function renderLiveError(message) {
      document.getElementById("liveSummary").innerHTML = `
        <div class="panel"><p>Live feed unavailable: ${escapeHtml(message)}</p></div>
      `;
      document.querySelector("#liveFrTable tbody").innerHTML = `<tr><td colspan="4">Live feed unavailable.</td></tr>`;
      document.querySelector("#liveCbpTable tbody").innerHTML = `<tr><td colspan="2">Live feed unavailable.</td></tr>`;
      document.querySelector("#liveRetaliationTable tbody").innerHTML = `<tr><td colspan="4">Live feed unavailable.</td></tr>`;
      document.getElementById("liveFeedErrors").innerHTML = `
        <h3>Feed Health</h3>
        <p class="small-note" style="margin:0;">${escapeHtml(message)}</p>
      `;
      renderHeadlineTicker([`Live feed unavailable: ${message}`]);
      applySectionRevealAnimation();
    }

    async function loadLiveIntel() {
      try {
        const response = await fetch("./data/live_intel.json", { cache: "no-store" });
        if (!response.ok) {
          throw new Error(`HTTP ${response.status} while loading data/live_intel.json`);
        }
        const payload = await response.json();
        renderLiveFeeds(payload);
      } catch (err) {
        renderLiveError(err?.message || "Unknown fetch error.");
      }
    }

    function annexRateAsNumber(country) {
      const text = ANNEX_RATES[country];
      if (!text) return null;
      const parsed = parseFloat(String(text).replace("%", ""));
      return Number.isFinite(parsed) ? parsed : null;
    }

    function reciprocalRateForScenario(country, mfnRate) {
      if (country === "China") {
        return {
          rate: 10,
          note: "PRC reciprocal baseline layer (heightened schedule suspended through 2026-11-10)."
        };
      }
      if (country === "EU" || isEuMember(country)) {
        return {
          rate: Math.max(0, 15 - mfnRate),
          note: "EU formula used: additional duty = max(0, 15% - Column 1/MFN rate)."
        };
      }
      const annex = annexRateAsNumber(country);
      if (Number.isFinite(annex)) {
        return {
          rate: annex,
          note: "Country-specific Annex I reciprocal schedule."
        };
      }
      return {
        rate: 10,
        note: "Default reciprocal baseline for non-listed countries."
      };
    }

    function section232RateForScenario(country, commodityKey) {
      const rule = CALC_COMMODITY_RULES[commodityKey] || CALC_COMMODITY_RULES.none;
      if (typeof rule.section232Rate !== "number") {
        return {
          rate: 0,
          note: "No Section 232 commodity layer selected."
        };
      }

      let rate = rule.section232Rate;
      if (country === "United Kingdom" && typeof rule.section232RateUk === "number") {
        rate = rule.section232RateUk;
      }
      if (country === "Japan" && typeof rule.section232RateJapan === "number") {
        rate = rule.section232RateJapan;
      }
      return {
        rate,
        note: `Commodity preset: ${rule.label}.`
      };
    }

    function runCalculator() {
      const country = canonicalCountry(document.getElementById("calcCountry").value) || "Canada";
      const commodityKey = document.getElementById("calcCommodity").value;
      const commodityRule = CALC_COMMODITY_RULES[commodityKey] || CALC_COMMODITY_RULES.none;

      const customsValue = Math.max(0, toNumber(document.getElementById("calcCustomsValue").value));
      const freightInsurance = Math.max(0, toNumber(document.getElementById("calcFreightInsurance").value));
      const mfnRate = Math.max(0, toNumber(document.getElementById("calcMfnRate").value));
      const section301Input = Math.max(0, toNumber(document.getElementById("calcSection301Rate").value));
      const quantity = Math.max(0, toNumber(document.getElementById("calcQuantity").value));
      const htsCode = document.getElementById("calcHts").value.trim();

      const includeContested = document.getElementById("calcIncludeContested").checked;
      const applyNonStacking = document.getElementById("calcApplyNonStacking").checked;
      const usmcaQualified = document.getElementById("calcUsmcaQualified").checked;
      const energyPotash = document.getElementById("calcEnergyPotash").checked;
      const brazilTargeted = document.getElementById("calcBrazilTargeted").checked;
      const includeSection122 = document.getElementById("calcIncludeSection122").checked;
      const section122Exempt = document.getElementById("calcSection122Exempt").checked;

      const section232 = section232RateForScenario(country, commodityKey);

      let section301Rate = 0;
      let section301Note = "No Section 301 layer in selected scenario.";
      if (commodityKey === "china_301_strategic" && country === "China") {
        const fallback = commodityRule.section301Default || 25;
        const section301Raw = document.getElementById("calcSection301Rate").value.trim();
        section301Rate = section301Raw === "" ? fallback : section301Input;
        section301Note = "China Section 301 strategic-product layer from user input.";
      } else if (commodityKey === "china_301_strategic" && country !== "China") {
        section301Note = "Section 301 strategic preset applies to China-origin products only.";
      }

      // Section 122 global surcharge (operative 10% under Feb 20, 2026 proclamation; effective Feb 24 2026 for covered non-exempt goods)
      let section122Rate = 0;
      let section122Note = "";
      if (commodityKey === "branded_pharma") {
        section122Note = "Branded pharma is EXEMPT from Section 122. 100% branded pharma tariff applies separately.";
      } else if (section122Exempt) {
        section122Note = "Goods marked as Section 122 exempt (pharma, certain ag, critical minerals, some electronics).";
      } else if (includeSection122) {
        section122Rate = 10;
        section122Note = "Section 122 global surcharge (10%) effective Feb 24 2026 for covered non-exempt goods under White House proclamation (Trade Act §122). Statutory max is 15%. Expires ~Jul 24 2026 without Congressional extension.";
      } else {
        section122Note = "Section 122 surcharge excluded from scenario.";
      }

      // Branded pharma special case
      let brandedPharmaRate = 0;
      let brandedPharmaNote = "No branded pharma tariff in selected scenario.";
      if (commodityKey === "branded_pharma") {
        brandedPharmaRate = 100;
        brandedPharmaNote = "100% tariff on branded/patented pharmaceuticals (effective Oct 1 2025). Exception: manufacturer with US plant under construction. UK-sourced: 0% under US-UK deal.";
        if (country === "United Kingdom") {
          brandedPharmaRate = 0;
          brandedPharmaNote = "UK-sourced pharma: 0% under U.S.-UK Economic Prosperity Deal (EO 14305).";
        }
      }

      let ieepaRate = 0;
      const ieepaDetails = [];
      if (includeContested) {
        const reciprocal = reciprocalRateForScenario(country, mfnRate);
        ieepaRate += reciprocal.rate;
        ieepaDetails.push(`Reciprocal: ${formatPercent(reciprocal.rate)}. ${reciprocal.note}`);

        if (country === "Canada" || country === "Mexico") {
          if (usmcaQualified) {
            ieepaDetails.push("USMCA-qualified flow selected: border IEEPA country layer assumed 0%.");
          } else if (energyPotash) {
            ieepaRate += 10;
            ieepaDetails.push("Energy/potash bucket applied at 10% for non-USMCA flow.");
          } else {
            const borderRate = country === "Canada" ? 35 : 25;
            ieepaRate += borderRate;
            ieepaDetails.push(`${country} non-USMCA border bucket applied at ${formatPercent(borderRate)}.`);
          }
        }

        if (country === "China") {
          ieepaRate += 10;
          ieepaDetails.push("PRC opioid-linked country layer added at 10%.");
        }

        if (country === "Brazil") {
          if (brazilTargeted) {
            ieepaRate += 40;
            ieepaDetails.push("Brazil targeted-products Annex layer applied at 40%.");
          } else {
            ieepaDetails.push("Brazil targeted-products layer not applied (checkbox not selected).");
          }
        }
      } else {
        ieepaDetails.push("Contested IEEPA layers excluded from this scenario.");
      }

      const specialBuckets = [
        { key: "section232", component: "Section 232 commodity layer", nominalRate: section232.rate, note: section232.note },
        { key: "section301", component: "Section 301 layer", nominalRate: section301Rate, note: section301Note },
        { key: "ieepa", component: "IEEPA layer(s) [STRUCK DOWN — historical/refund analysis only]", nominalRate: ieepaRate, note: ieepaDetails.join(" ") },
        { key: "section122", component: "Section 122 global surcharge (Feb 24 2026)", nominalRate: section122Rate, note: section122Note },
        { key: "branded_pharma", component: "Branded pharma tariff (100%)", nominalRate: brandedPharmaRate, note: brandedPharmaNote }
      ];

      let winner = null;
      if (applyNonStacking) {
        const ranked = specialBuckets
          .filter((row) => row.nominalRate > 0)
          .sort((a, b) => {
            if (b.nominalRate !== a.nominalRate) return b.nominalRate - a.nominalRate;
            return CALC_PRIORITY.indexOf(a.key) - CALC_PRIORITY.indexOf(b.key);
          });
        winner = ranked[0] || null;
      }

      const rows = [
        {
          component: "MFN / Column 1 baseline",
          nominalRate: mfnRate,
          appliedRate: mfnRate,
          note: "Input by user; always stacked in this estimator."
        }
      ];

      specialBuckets.forEach((bucket) => {
        let appliedRate = bucket.nominalRate;
        let note = bucket.note;
        if (applyNonStacking && bucket.nominalRate > 0) {
          if (winner && winner.key === bucket.key) {
            note = `Applied as highest special-duty bucket under non-stacking. ${note}`;
          } else if (winner) {
            appliedRate = 0;
            note = `Suppressed by non-stacking assumption; ${winner.component} selected. ${note}`;
          }
        }

        rows.push({
          component: bucket.component,
          nominalRate: bucket.nominalRate,
          appliedRate,
          note
        });
      });

      rows.push({
        component: "Freight + insurance",
        nominalRate: 0,
        appliedRate: 0,
        note: "Included in landed cost total; not duty-bearing in this simplified model."
      });

      rows.forEach((row) => {
        row.dutyAmount = customsValue * (row.appliedRate / 100);
      });

      const totalDuty = rows.reduce((sum, row) => sum + row.dutyAmount, 0);
      const totalLanded = customsValue + freightInsurance + totalDuty;
      const effectiveRate = customsValue > 0 ? (totalDuty / customsValue) * 100 : 0;
      const landedPerUnit = quantity > 0 ? totalLanded / quantity : null;

      const summary = document.getElementById("calcSummary");
      const summaryCards = [
        { label: "Country", value: country },
        { label: "Commodity", value: commodityRule.label },
        { label: "Affected products", value: commodityRule.affected },
        { label: "Total duty", value: formatMoney(totalDuty) },
        { label: "Total landed", value: formatMoney(totalLanded) },
        { label: "Effective duty rate", value: formatPercent(effectiveRate) }
      ];
      if (landedPerUnit !== null) {
        summaryCards.push({ label: "Landed per unit", value: formatMoney(landedPerUnit) });
      }
      if (htsCode) {
        summaryCards.push({ label: "HTS reference", value: htsCode });
      }

      summary.innerHTML = summaryCards
        .map((item) => `<div class="metric"><div class="label">${escapeHtml(item.label)}</div><div class="value">${escapeHtml(item.value)}</div></div>`)
        .join("");

      const tbody = document.querySelector("#calcBreakdownTable tbody");
      tbody.innerHTML = rows.map((row) => `
        <tr>
          <td>${escapeHtml(row.component)}</td>
          <td>${formatPercent(row.nominalRate)}</td>
          <td>${formatPercent(row.appliedRate)}</td>
          <td>${formatMoney(row.dutyAmount)}</td>
          <td>${escapeHtml(row.note)}</td>
        </tr>
      `).join("");
    }

    // Country flag emoji map for featured/common countries
    const COUNTRY_FLAGS = {
      "Canada": "🇨🇦", "Mexico": "🇲🇽", "China": "🇨🇳", "Germany": "🇩🇪",
      "Japan": "🇯🇵", "South Korea": "🇰🇷", "India": "🇮🇳", "Taiwan": "🇹🇼",
      "United Kingdom": "🇬🇧", "Vietnam": "🇻🇳", "Brazil": "🇧🇷", "Switzerland": "🇨🇭",
      "Singapore": "🇸🇬", "France": "🇫🇷", "Netherlands": "🇳🇱", "Italy": "🇮🇹",
      "Australia": "🇦🇺", "Israel": "🇮🇱", "Thailand": "🇹🇭", "Malaysia": "🇲🇾",
      "Indonesia": "🇮🇩", "Ireland": "🇮🇪", "Spain": "🇪🇸", "Belgium": "🇧🇪",
      "Sweden": "🇸🇪", "Poland": "🇵🇱", "Czech Republic": "🇨🇿", "Hungary": "🇭🇺",
      "United States": "🇺🇸", "Russia": "🇷🇺", "Saudi Arabia": "🇸🇦", "Turkey": "🇹🇷",
      "Argentina": "🇦🇷", "Chile": "🇨🇱", "Colombia": "🇨🇴", "Philippines": "🇵🇭",
      "Bangladesh": "🇧🇩", "Pakistan": "🇵🇰", "Cambodia": "🇰🇭", "Myanmar": "🇲🇲",
    };

    const FEATURED_COUNTRIES = [
      "Canada", "China", "Germany", "Mexico", "Japan", "South Korea",
      "India", "Taiwan", "United Kingdom", "Vietnam", "Brazil", "Switzerland"
    ];

    // Country tariff exposure tags shown in dropdown
    const COUNTRY_TAGS = {
      "Canada": "S.232 + S.122", "Mexico": "S.232 + S.122", "China": "S.301 + S.232",
      "Germany": "S.232 + S.122", "Japan": "S.232 + S.122", "South Korea": "S.232 + S.122",
      "India": "S.232 + S.122", "Taiwan": "S.232 + S.122", "United Kingdom": "S.232",
      "Vietnam": "S.232 + S.122", "Brazil": "S.232 + S.122", "Switzerland": "S.232 + S.122",
    };

    let _allCountryNames = [];

    async function populateCountries() {
      const calcCountry = document.getElementById("calcCountry");
      let names = [...FALLBACK_COUNTRIES];

      try {
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 3000);
        const response = await fetch("https://restcountries.com/v3.1/all?fields=name", { signal: controller.signal });
        clearTimeout(timeout);
        if (response.ok) {
          const json = await response.json();
          const fetched = json
            .map((row) => row?.name?.common)
            .filter(Boolean)
            .map((x) => COUNTRY_ALIASES[x] || x);
          names = Array.from(new Set([...fetched, ...FALLBACK_COUNTRIES])).sort((a, b) => a.localeCompare(b));
        }
      } catch (err) {
        // Fallback list is sufficient if live country API is unavailable.
      }

      _allCountryNames = names;
      initCountrySearch();

      const current = canonicalCountry(calcCountry.value) || "Canada";
      calcCountry.innerHTML = names.map((name) => `<option value="${name}">${name}</option>`).join("");
      calcCountry.value = names.includes(current) ? current : "Canada";
    }

    function initCountrySearch() {
      const wrap = document.getElementById("countrySearch");
      const input = document.getElementById("countryInput");
      const dropdown = document.getElementById("csDropdown");
      const list = document.getElementById("csList");
      const sectionLabel = document.getElementById("csSectionLabel");
      const clearBtn = document.getElementById("csClear");
      let focusedIdx = -1;

      function getFlag(name) {
        return COUNTRY_FLAGS[name] || "🌐";
      }

      function highlightMatch(name, query) {
        if (!query) return escapeHtml(name);
        const idx = name.toLowerCase().indexOf(query.toLowerCase());
        if (idx === -1) return escapeHtml(name);
        return escapeHtml(name.slice(0, idx))
          + `<em>${escapeHtml(name.slice(idx, idx + query.length))}</em>`
          + escapeHtml(name.slice(idx + query.length));
      }

      function renderItems(items, query) {
        focusedIdx = -1;
        if (!items.length) {
          list.innerHTML = `<div class="cs-no-results">No countries found for "${escapeHtml(query)}"</div>`;
          return;
        }
        list.innerHTML = items.map((name, i) => {
          const tag = COUNTRY_TAGS[name] ? `<span class="cs-tag">${COUNTRY_TAGS[name]}</span>` : "";
          return `<div class="cs-item" data-name="${escapeHtml(name)}" data-idx="${i}">
            <span class="cs-flag">${getFlag(name)}</span>
            <span class="cs-name">${highlightMatch(name, query)}</span>
            ${tag}
          </div>`;
        }).join("");
        list.querySelectorAll(".cs-item").forEach(el => {
          el.addEventListener("mousedown", e => {
            e.preventDefault();
            selectCountry(el.dataset.name);
          });
        });
      }

      function openDropdown(items, query, label) {
        sectionLabel.textContent = label;
        renderItems(items, query);
        dropdown.hidden = false;
      }

      function closeDropdown() {
        dropdown.hidden = true;
        focusedIdx = -1;
      }

      function selectCountry(name) {
        input.value = name;
        wrap.classList.add("has-value");
        closeDropdown();
        renderCountry(name);
      }

      function moveFocus(dir) {
        const items = list.querySelectorAll(".cs-item");
        if (!items.length) return;
        items[focusedIdx]?.classList.remove("cs-focused");
        focusedIdx = Math.max(0, Math.min(items.length - 1, focusedIdx + dir));
        items[focusedIdx].classList.add("cs-focused");
        items[focusedIdx].scrollIntoView({ block: "nearest" });
      }

      input.addEventListener("focus", () => {
        const query = input.value.trim();
        if (!query) {
          openDropdown(FEATURED_COUNTRIES.filter(n => _allCountryNames.includes(n)), "", "Featured Countries");
        } else {
          const filtered = _allCountryNames.filter(n => n.toLowerCase().includes(query.toLowerCase())).slice(0, 40);
          openDropdown(filtered, query, `Results for "${query}"`);
        }
      });

      input.addEventListener("input", () => {
        const query = input.value.trim();
        wrap.classList.toggle("has-value", query.length > 0);
        if (!query) {
          openDropdown(FEATURED_COUNTRIES.filter(n => _allCountryNames.includes(n)), "", "Featured Countries");
        } else {
          const filtered = _allCountryNames.filter(n => n.toLowerCase().includes(query.toLowerCase())).slice(0, 40);
          openDropdown(filtered, query, `Results (${Math.min(filtered.length, 40)})`);
        }
      });

      input.addEventListener("keydown", e => {
        if (dropdown.hidden) return;
        if (e.key === "ArrowDown") { e.preventDefault(); moveFocus(1); }
        else if (e.key === "ArrowUp") { e.preventDefault(); moveFocus(-1); }
        else if (e.key === "Enter") {
          e.preventDefault();
          const focused = list.querySelector(".cs-focused");
          if (focused) selectCountry(focused.dataset.name);
          else if (input.value.trim()) { closeDropdown(); renderCountry(input.value.trim()); }
        }
        else if (e.key === "Escape") closeDropdown();
      });

      clearBtn.addEventListener("click", () => {
        input.value = "";
        wrap.classList.remove("has-value");
        input.focus();
      });

      document.addEventListener("click", e => {
        if (!wrap.contains(e.target)) closeDropdown();
      });

      // Mark as has-value if pre-filled
      if (input.value.trim()) wrap.classList.add("has-value");
    }

    function bindTabs() {
      const tabButtons = Array.from(document.querySelectorAll(".fnkey"));
      const views = Array.from(document.querySelectorAll(".view"));

      tabButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const target = btn.getAttribute("data-view-target");
          tabButtons.forEach((x) => x.classList.toggle("active", x === btn));
          views.forEach((view) => view.classList.toggle("active", view.getAttribute("data-view") === target));
          applySectionRevealAnimation();
        });
      });
    }

    async function bootstrap() {
      document.getElementById("lastVerified").textContent = META.asOf;
      renderSection122Countdown();
      renderHeadlineTicker([]);
      renderKpis();
      setTimeout(animateKpiCountUp, 200);
      renderCommodities();
      renderTimeline();
      renderSources();
      renderGaps();
      bindTabs();
      await populateCountries();
      renderCountry("Canada");
      runCalculator();
      applySectionRevealAnimation();
      await loadLiveIntel();

      document.getElementById("runCalcButton").addEventListener("click", runCalculator);
      [
        "calcCountry",
        "calcCommodity",
        "calcMfnRate",
        "calcSection301Rate",
        "calcHts",
        "calcCustomsValue",
        "calcFreightInsurance",
        "calcQuantity",
        "calcIncludeContested",
        "calcApplyNonStacking",
        "calcUsmcaQualified",
        "calcEnergyPotash",
        "calcBrazilTargeted",
        "calcIncludeSection122",
        "calcSection122Exempt"
      ].forEach((id) => {
        const element = document.getElementById(id);
        if (!element) return;
        const eventName = element.tagName === "INPUT" && element.type === "number" ? "input" : "change";
        element.addEventListener(eventName, runCalculator);
      });
    }

    function renderSection122Countdown() {
      const countdownEl = document.getElementById("section122Countdown");
      if (!countdownEl) return;
      const expiryDate = new Date("2026-07-24T00:00:00Z");
      const now = new Date();
      const diff = expiryDate - now;
      if (diff <= 0) {
        countdownEl.textContent = "EXPIRED — Congressional extension required";
        return;
      }
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      countdownEl.textContent = `${days}d ${hours}h ${minutes}m remaining`;
    }

    document.addEventListener("DOMContentLoaded", bootstrap);

    // Update countdown every 30 seconds
    setInterval(renderSection122Countdown, 30000);

    // ── Theme Toggle ──────────────────────────────────
    (function initTheme() {
      const html = document.documentElement;
      const btn  = document.getElementById("themeToggle");
      const lbl  = document.getElementById("themeLabel");

      // Apply saved or system-preferred theme on load
      const saved = localStorage.getItem("tariffTheme");
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      const initial = saved || (prefersDark ? "dark" : "light");
      applyTheme(initial);

      if (btn) {
        btn.addEventListener("click", () => {
          const current = html.getAttribute("data-theme") || "dark";
          applyTheme(current === "dark" ? "light" : "dark");
        });
      }

      function applyTheme(theme) {
        html.setAttribute("data-theme", theme);
        localStorage.setItem("tariffTheme", theme);
        if (lbl) lbl.textContent = theme === "dark" ? "Light" : "Dark";
        if (btn) btn.setAttribute("aria-pressed", theme === "light" ? "true" : "false");
      }

      // Listen for OS-level theme change
      window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", (e) => {
        if (!localStorage.getItem("tariffTheme")) {
          applyTheme(e.matches ? "dark" : "light");
        }
      });
    })();
  </script>
</body>
</html>
